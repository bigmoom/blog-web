<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta name="google-site-verification" content="_i0mgfxBy6QPgJZLx5NbYfLAp5i5xqHoSKIcpYOPHM0" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="_i0mgfxBy6QPgJZLx5NbYfLAp5i5xqHoSKIcpYOPHM0">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"www.caiwanghui.top","root":"/","scheme":"Mist","version":"7.7.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="一些零零散散的学习总结">
<meta property="og:type" content="website">
<meta property="og:title" content="菜鸡肥肥的私人博客">
<meta property="og:url" content="http://www.caiwanghui.top/index.html">
<meta property="og:site_name" content="菜鸡肥肥的私人博客">
<meta property="og:description" content="一些零零散散的学习总结">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Wanghui Cai">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://www.caiwanghui.top/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false
  };
</script>

  <title>菜鸡肥肥的私人博客</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">菜鸡肥肥的私人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-fw fa-home"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content">
            

  <div class="posts-expand">
        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.caiwanghui.top/2021/06/15/SpringBoot-AOP/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Wanghui Cai">
      <meta itemprop="description" content="一些零零散散的学习总结">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="菜鸡肥肥的私人博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/15/SpringBoot-AOP/" class="post-title-link" itemprop="url">SpringBoot-AOP</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-06-14 22:13:34 / 修改时间：14:16:23" itemprop="dateCreated datePublished" datetime="2021-06-14T22:13:34Z">2021-06-14</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>6.6k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>6 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>SpringBoot 使用 AOP</h1>
<h3 id="AOP-简介">AOP 简介</h3>
<p><code>Springboot</code>两个核心思想便是<code>IOC</code>和<code>AOP</code>。关于<code>IOC</code>控制反转我在<a href="">初识SpringBoot</a>中已经具体介绍了，所以这次就来仔细介绍一下<code>AOP</code></p>
<p><code>AOP</code>即<code>Aspect Oriented Programming</code>，面向切面编程。<code>AOP</code>和<code>OOP</code>一样，只是一种编程范式，没有具体的编程规范。</p>
<p>我们先来看一个简单的例子：</p>
<p>我们有三个类，我想在对每个类都添加日志记录的功能</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">Public <span class="class"><span class="keyword">class</span> <span class="title">A</span></span>&#123;</span><br><span class="line"> <span class="function">Public <span class="keyword">void</span> <span class="title">do</span><span class="params">()</span></span>&#123;</span><br><span class="line"> …</span><br><span class="line"> Record.addRecord();<span class="comment">//添加日志</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Public <span class="class"><span class="keyword">class</span> <span class="title">B</span></span>&#123;</span><br><span class="line"> <span class="function">Public <span class="keyword">void</span> <span class="title">do</span><span class="params">()</span></span>&#123;</span><br><span class="line"> …</span><br><span class="line"> Record.addRecord();<span class="comment">//添加日志</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line">Public <span class="class"><span class="keyword">class</span> <span class="title">C</span></span>&#123;</span><br><span class="line"> <span class="function">Public <span class="keyword">void</span> <span class="title">do</span><span class="params">()</span></span>&#123;</span><br><span class="line"> …</span><br><span class="line"> Record.addRecord();<span class="comment">//添加日志</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这就是我们之前<code>OOP</code>思想下的实现方法，虽然没有什么问题，但是很繁琐。毕竟我们的项目不可能就只有几个类，我们的功能也不可能只有记录日志这种功能，倘若要一个一个手动添加编写实在是太过低效。</p>
<p>此时<code>AOP</code>就思想就很重要。</p>
<p>简单来说，就是横向看我们的程序，有很多方法并列，此时我们对某一类方法一刀切，设置一个处理功能，例如记录日志，权限认证，异常处理等等。</p>
<p><img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210610103319.png" alt=""></p>
<p>在<code>Springboot</code>中，我们就是设置一个切入点标识，标记一类方法。然后我们编写切入点要实现的功能。这样程序运行时，捕获到切入点即调用切入点的方法进行相应处理。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogAspect</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"@annotation(com.cwh.springboot.springboot_aop.annotation.Log)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logPointCut</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around</span>(<span class="string">"logPointCut()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">recordTime</span><span class="params">(ProceedingJoinPoint joint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:SS"</span>);</span><br><span class="line">        Long beginTime = System.currentTimeMillis();</span><br><span class="line">        log.info(sdf.format(beginTime));</span><br><span class="line">        log.info(<span class="string">"开始执行"</span>);</span><br><span class="line">        Object result = joint.proceed();</span><br><span class="line">        log.info(<span class="string">"执行结束"</span>);</span><br><span class="line">        Long endTime = System.currentTimeMillis();</span><br><span class="line">        log.info(sdf.format(endTime));</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>例如这个简单的日志记录的切面</p>
<p><code> @Pointcut(&quot;@annotation(com.cwh.springboot.springboot_aop.annotation.Log)&quot;)</code>这是标明使用了放在<code>com.cwh.springboot.springboot_aop.annotation</code>中的<code>Log</code>注解的地方为切入点</p>
<p><code>@Around(&quot;logPointCut()&quot;)</code>这是标明我们在上述定义的切入点要执行的操作，具体介绍后面会细讲。</p>
<p><code>SpringBoot</code>中的<code>AOP</code>使用的是动态代理的技术，在运行时动态生成目标对象的代理对象，然后在代理对象中对目标对象进行增强，即增添一些功能。</p>
<blockquote>
<p>关于动态代理，静态代理建议另外详看，非常重要的一个知识点。</p>
</blockquote>
<p>接下来我们来看一下<code>AOP</code>中的一些非常重要的概念</p>
<h4 id="JoinPoint-连接点"><code>JoinPoint</code> 连接点</h4>
<p>就是我们想要进行方法增强的那些方法</p>
<h4 id="PointCut-切入点"><code>PointCut</code> 切入点</h4>
<p>切入点是用来匹配相应的连接点的一个概念。</p>
<blockquote>
<p><code>    @Pointcut(&quot;@annotation(com.cwh.springboot.springboot_aop.annotation.Log)&quot;)  public void logPointCut(){}</code></p>
<p>这就是定义了一个匹配规则的切入点</p>
</blockquote>
<h4 id="Advice-通知"><code>Advice</code> 通知</h4>
<p>其实就是在切入点前后执行的方法，包括如下几种通知</p>
<ul>
<li><code>Before</code> 前置通知，在切入点目标方法执行之前执行的方法</li>
<li><code>After</code>后置通知，在切入点目标方法执行之后执行的方法</li>
<li><code>Around</code>环绕通知 定义在切入点目标方法执行之前执行相关操作和之后执行相关操作的方法</li>
<li><code>AfterReturning</code> 后置返回通知，在目标方法正常返回后执行，可以在通知中绑定返回值</li>
<li><code>AfterThrowing</code> 后置异常通知，在方法抛出异常退出时执行，也可以在通知同绑定抛出</li>
</ul>
<blockquote>
<p>不同<code>Advice</code>拦截顺序</p>
<ul>
<li>
<p>该方法只有一个<code>Aspect</code></p>
<p>无异常：<code>@Around</code>（<code>proceed()</code>之前的部分） → <code>@Before</code> → 方法执行 → <code>@Around</code>（<code>proceed()</code>之后的部分） → <code>@After</code> → <code>@AfterReturning</code></p>
<p>有异常：<code>@Around</code>（<code>proceed()</code>之前的部分） → <code>@Before</code> →抛异常→  <code>@After</code> → <code>@AfterThrowing</code>（因为抛出异常了，所以<code>@Around</code>中<code>proceed()</code>后面的部分也就不执行了）</p>
</li>
<li>
<p>一个方法有多个<code>Aspect</code></p>
<p>通过为<code>@Aspect</code>设置<code>@Order(num)</code>来定义优先顺序，<code>@Order</code>中的值越小越先执行</p>
<p>若没有设置，便和线程一样，谁先谁后不一定</p>
</li>
</ul>
<p>Tips:</p>
<ul>
<li>如果在同一个 <code>aspect</code> 类中，针对同一个 <code>pointcut</code>，定义了两个相同的 <code>advice</code>(比如，定义了两个 <code>@Before</code>)，那么这两个 <code>advice</code> 的执行顺序是无法确定的，哪怕你给这两个 <code>advice</code> 添加了 <code>@Order</code> 这个注解，也不行。</li>
<li>对于<code>@Around</code>，不管它有没有返回值，但是必须要方法内部，调用一下<code>jointPoint.proceed()</code>;否则，<code>Controller</code> 中的接口将没有机会被执行，从而也导致了 <code>@Before</code>不会被触发。</li>
</ul>
</blockquote>
<h4 id="Aspect-切面"><code>Aspect</code> 切面</h4>
<p>其实就是包括了一些<code>PointCut</code>和<code>Advice</code>的模块</p>
<h3 id="使用示例">使用示例</h3>
<p><a href="https://github.com/bigmoom/springboot/tree/main/springboot-AOP" target="_blank" rel="noopener">程序源码</a></p>
<h4 id="pom-xml">pom.xml</h4>
<p>添加<code>aop</code>依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--AOP依赖--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="application-yml">application.yml</h4>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8090</span></span><br></pre></td></tr></table></figure>
<h4 id="annotation">annotation</h4>
<h5 id="Log">Log</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义注解，以标记切入点</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> cwh</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/6/10 9:25</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">//设置注解位置，此处为方法上注解</span></span><br><span class="line"><span class="meta">@Target</span>(ElementType.METHOD)</span><br><span class="line"><span class="comment">//设置注解生命周期，此处为存在程序运行过程中</span></span><br><span class="line"><span class="meta">@Retention</span>(RetentionPolicy.RUNTIME)</span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Log &#123;</span><br><span class="line">    <span class="function">String <span class="title">value</span><span class="params">()</span> <span class="keyword">default</span> ""</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里我们自定义一个注解以标记<code>JointPoint</code></p>
<blockquote>
<p>这里简单介绍一下自定义注解</p>
<p>我们使用<code>public @interface 注解名{注解体}</code>的方式去定义一个注解</p>
<p>自定义注解需要使用一些元注解去设置注解的一些属性</p>
<p><code>@Target</code>：用于定于该注解可以用在什么地方</p>
<p>​	<code>METHOD</code> 方法声明</p>
<p>​	<code>TYPE</code> 类，接口或<code>enum</code>声明</p>
<p>​	<code>PARAMETER</code> 参数声明</p>
<p>​	<code>Constructor</code> 构造器声明</p>
<p>​	…</p>
<p><code>@Doucumented</code> 用于标记在生成<code>javadoc</code>的时候是否将注解包含进去</p>
<p><code>@Retention</code> 用于标明注解的声明周期</p>
<p>​	<code>RUNTIME</code> 运行时级别 存在于源码，字节码，JVM中，用于运行时通过反射获取相关信息</p>
<p>​	<code>SOURCE</code> 源码级别 只存在与源码中，用于和编译器交互</p>
<p>​	<code>CLASS</code> 字节码级别 存在与源码和字节码中, 主要用于编译是产生额外的文件</p>
<p><code>@Inherited</code> 用于标记被标注的类的子类可以继承父类的注解，通过反射获取父类的注解</p>
<p>注解体中我们设置注解的一些属性，格式为<code>数据类型 属性名() default 默认值</code></p>
</blockquote>
<h4 id="Aspect">Aspect</h4>
<p><code>Springboot</code>中设置切入点主要有两种方式</p>
<ol>
<li>
<p>自定义注解，在连接点加上该注解，然后在<code>@Pointcut(&quot;@annotation(地址)&quot;)</code>中添加注解在项目中的位置</p>
<blockquote>
<p><code>  @Pointcut(&quot;@annotation(com.cwh.springboot.springboot_aop.annotation.Log)&quot;)</code></p>
</blockquote>
</li>
<li>
<p>使用<code>execution</code>语句<code>@Pointcut(execution(方法修饰符(可选)返回类型 类路径 方法名 参数 异常模式(可选))</code></p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>）execution(<span class="keyword">public</span> * *(..))——表示匹配所有<span class="keyword">public</span>方法</span><br><span class="line"><span class="number">2</span>）execution(* set*(..))——表示所有以“set”开头的方法</span><br><span class="line"><span class="number">3</span>）execution(* com.cwh.service.AccountService.*(..))——表示匹配所有AccountService接口的方法</span><br><span class="line"><span class="number">4</span>）execution(* com.cwh.service.*.*(..))——表示匹配service包下所有的方法</span><br><span class="line"><span class="number">5</span>）execution(* com.cwh.service..*.*(..))——表示匹配service包和它的子包下的方法</span><br></pre></td></tr></table></figure>
</blockquote>
</li>
</ol>
<h5 id="LogAspect">LogAspect</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogAspect</span> </span>&#123;</span><br><span class="line"><span class="comment">//  定义切入点</span></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"@annotation(com.cwh.springboot.springboot_aop.annotation.Log)"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logPointCut</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//  定义Around通知，并标明匹配切入点  </span></span><br><span class="line">    <span class="meta">@Around</span>(<span class="string">"logPointCut()"</span>)</span><br><span class="line"><span class="comment">//  Around通知必须要传入joinPoint，并且调用joinPoint.proceed()</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">recordTime</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        SimpleDateFormat sdf = <span class="keyword">new</span> SimpleDateFormat(<span class="string">"yyyy-MM-dd HH:mm:SS"</span>);</span><br><span class="line">        Long beginTime = System.currentTimeMillis();</span><br><span class="line">        log.info(sdf.format(beginTime));</span><br><span class="line">        log.info(<span class="string">"开始执行"</span>);</span><br><span class="line">        Object result = joinPoint.proceed();</span><br><span class="line">        log.info(<span class="string">"执行结束"</span>);</span><br><span class="line">        Long endTime = System.currentTimeMillis();</span><br><span class="line">        log.info(sdf.format(endTime));</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里使用的是<code>@Around</code>通知做日志记录，我们传入<code>ProceedingJoinPoint joinPoint</code>为切入点。</p>
<p><code>joinPoint.proceed()</code>为执行被代理对象的方法。</p>
<h5 id="WebAspect">WebAspect</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebLogAspect</span> </span>&#123;</span><br><span class="line"><span class="comment">//  定义切入点</span></span><br><span class="line">    <span class="meta">@Pointcut</span>(<span class="string">"execution(* com.cwh.springboot.springboot_aop.controller.*.*(..))"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logPointCut</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  前置通知 获取Request参数  </span></span><br><span class="line">    <span class="meta">@Before</span>(<span class="string">"logPointCut()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doBefore</span><span class="params">(JoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable </span>&#123;</span><br><span class="line">        ServletRequestAttributes attributes = (ServletRequestAttributes)</span><br><span class="line">                RequestContextHolder.getRequestAttributes();</span><br><span class="line">        HttpServletRequest request = attributes.getRequest();</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">"请求地址:"</span>+request.getRequestURI().toString());</span><br><span class="line">        log.info(<span class="string">"HTTP METHOD:"</span>+request.getMethod());</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">"CLASS_METHOD:"</span>+joinPoint.getSignature().getDeclaringTypeName()+<span class="string">"."</span>+</span><br><span class="line">                joinPoint.getSignature().getName());</span><br><span class="line"></span><br><span class="line">        log.info(<span class="string">"参数:"</span>+ Arrays.toString(joinPoint.getArgs()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  后置返回通知 获取返回值  </span></span><br><span class="line">    <span class="meta">@AfterReturning</span>(returning = <span class="string">"result"</span>, pointcut = <span class="string">"logPointCut()"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterReturning</span><span class="params">(Object result)</span> <span class="keyword">throws</span> Throwable</span>&#123;</span><br><span class="line">        log.info(<span class="string">"返回值为："</span>+result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>该前面主要是使用了一个前置通知获取<code>HttpRequest</code>中的一些参数，以及一个后置返回通知打印返回值。</p>
<blockquote>
<p>前置通知中我们传入的为<code>JoinPoint</code>对象而非<code>ProceedingJoinPoint</code>对象，因为除了<code>Around</code>通知，其他都不能调用方法的执行，所以<code>ProceedingJoinPoint</code>只能在<code>Around</code>通知中使用</p>
</blockquote>
<blockquote>
<p><code>RequestContextHolder.getRequestAttributes()</code>获取 对<code>servlet</code>所有的请求参数，通过<code>RequestContextHolder</code>管理保存</p>
<p><code>HttpServletRequest request = attributes.getRequest()</code> 获取<code>request</code>信息</p>
<p><code>HttpServletResponse response = attributes.getResponse()</code> 获取<code>response</code>信息</p>
</blockquote>
<blockquote>
<p>我们使用<code>joinPoint.getSignature()</code>获取被代理对象的签名，包括<strong>修饰符</strong>，<strong>包名</strong>，<strong>类名</strong>，<strong>方法名</strong></p>
<p><code>.getDeclaringTypeName()</code> 获取类名</p>
<p><code>.getName()</code>获取方法名</p>
<p><code>.getTarget()</code> 获取被代理对象</p>
<p><code>.getArgs()</code>获取参数</p>
</blockquote>
<p>后置通知中我们可以通过设置<code>returning =&quot;xxx&quot;</code>，这样方法参数中便可以传入返回值（参数名必须也注解中一样）。常用于对返回值的增强处理。</p>
<h4 id="Controller">Controller</h4>
<h5 id="TestController">TestController</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerpublic</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;    <span class="meta">@Log</span>    <span class="meta">@GetMapping</span>(<span class="string">"/log"</span>)    <span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">()</span></span>&#123;        <span class="keyword">return</span> <span class="string">"----------------------loading---------------"</span>;    &#125;&#125;</span><br></pre></td></tr></table></figure>
<p>因为程序很简单，所以只需一个非常简单的<code>controller</code>即可。</p>
<h4 id="运行结果">运行结果</h4>
<h5 id="GET-log"><code>GET</code> <code>/log</code></h5>
<img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210610140316.png" style="zoom:150%;" />
<p>我们可以看到控制台在程序执行前实现了功能增强</p>
<p>打印除了程序执行的时间，请求<code>url</code>,请求方式，调用的方法，参数，返回值加强。</p>
<h3 id="总结">总结</h3>
<p><code>AOP</code>很简单，重点是要掌握面向切面的编程思想。</p>
<p><code>AOP</code>之后在权限验证方面非常重要，具体操作后面再继续介绍。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.caiwanghui.top/2021/06/15/SpringBoot%E6%95%B4%E5%90%88springsecurity/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Wanghui Cai">
      <meta itemprop="description" content="一些零零散散的学习总结">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="菜鸡肥肥的私人博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/15/SpringBoot%E6%95%B4%E5%90%88springsecurity/" class="post-title-link" itemprop="url">SpringBoot整合springsecurity</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-06-14 22:12:44 / 修改时间：14:17:31" itemprop="dateCreated datePublished" datetime="2021-06-14T22:12:44Z">2021-06-14</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>3.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>3 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>Springboot整合springsecurity</h1>
<h3 id="简介">简介</h3>
<p>我们知道，<strong>登录认证</strong>和<strong>权限验证</strong>是现在每个涉及到用户登录的系统都不必不可缺的。</p>
<p>本文会简单介绍登录认证和权限认证相关的知识，以及如何使用<code>springsecurity</code>框架实现相关功能。</p>
<h3 id="基础知识">基础知识</h3>
<h4 id="登录认证">登录认证</h4>
<p>登录认证的概念非常简单，主要是处理两个问题，<strong>登录密码校验</strong>和<strong>验证登录状态</strong></p>
<h5 id="登录密码校验">登录密码校验</h5>
<p>系统一般都有登录界面，用户在登录界面输入用户名和登录密码。</p>
<p>那么我们要做的就是根据用户名，去用户数据库中查询到用户的密码，然后将数据库中的密码与用户输入的密码进行比对。如果相同，那么登录成功，如果不同，则提示账号密码错误。</p>
<h5 id="认证登录状态">认证登录状态</h5>
<p>我们要知道<code>HTTP</code>请求是一个<strong>无状态</strong>协议，即每次的请求都是相互独立的。服务器不会知晓你之前的行为，只会看到你当前的请求。</p>
<p>所以我们需要一种机制能够将用户的登录状态保存下来，即<strong>凭证</strong>。用户登录之后，每次发送请求的同时携带该凭证，那么服务器就可以通过这个凭证认证你的登录状态。</p>
<p>现在最常用的便是使用<code>Session</code>，<code>Token</code>，<code>Cookie</code>携带凭证。</p>
<h6 id="Session">Session</h6>
<p><code>session</code>即会话，用户访问服务器是便是与服务器产生了一次<code>session</code>。服务器为了记住该用户，则在服务器上使用<code>session</code>存储这个用户的信息。</p>
<p><code>session</code>不会随着浏览器的关闭而消失，他具有可定义失效日期，失效后服务器便认为与客户端断开联系，并删除<code>session</code>以节约空间。</p>
<p><code>session</code>的缺点很明显，就是会占用服务器的存储空间。当服务器的访问较少时，<code>session</code>还是可行的，但是当有大量的访问时，便会占用服务器的负载和性能。</p>
<p>此外，对于分布式的系统，为了负载均衡，同一个访问会分配到不同的服务器，所以一个用户登录之后，将信息保存在登录时的服务器上，但是后续可能就被分配到另外的服务器上，这就导致要重新登录。这是非常不能接受的。</p>
<blockquote>
<p>当然我们可以使用<code>springsession</code>实现分布式会话管理，实现<code>session</code>共享功能。</p>
</blockquote>
<h6 id="Cookie">Cookie</h6>
<p>为了解决<code>session</code>保存在服务器上的问题，<code>cookie</code>同样由服务器生成（与<code>session</code>一样，生成的是<code>session ID</code>），但是交由浏览器保存在客户端本地，以<code>key-value</code>形式存储用户信息。</p>
<p>其实就是写在客户端的一段<code>txt</code>文件，里面包括了你的登录信息，这样下次登录时就会自动调用<code>cookie</code>登录。</p>
<p><img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210611133943.png" alt=""></p>
<p>这就是我使用<code>Chrome</code>浏览器中<code>github</code>上的<code>cookies</code></p>
<blockquote>
<p><code>name</code>（名字）+<code>value</code>（值）+<code>Domain</code>（域名）+<code>Path</code>（路径）+<code>Expires</code>（过期时间）+<code>Size</code>（大小）</p>
</blockquote>
<p><code>cookie</code>相较<code>session</code>对于服务器更加友好，但是由于存储在客户端，容易被修改，所以非常不安全</p>
<p>此外，<code>cookie</code>只能保存少量数据，而且是基于使用的浏览器而不同的，不同浏览器访问相同网页使用的<code>cookie</code>都是不同的。</p>
<h6 id="Token">Token</h6>
<p><code>token</code>是目前较为主流的一种凭证，他的基本思想便是提供一个加密和解密的功能</p>
<p>用户登录之后，根据一段数据，可以是用户名或者其他数据，加密成一段字符串，并返回给客户端。客户端脚本会将<code>token</code>储存起来，可以是存储到<code>cookie</code>也开始是<code>localStorage</code></p>
<p>之后用户再次访问该域名时，便会将<code>token</code>放到 <code>Authorization header</code>中，此时服务器可以是对该<code>token</code>进行解密或者对数据进行再次加密，检查是否匹配。若解密成功或者匹配成功即实现登陆认证。</p>
<blockquote>
<p>其实<code>cookie</code>和<code>session</code>只是将服务器生成的<code>session id</code>存储到了不同的地方，一个存储在服务器，一个存储在客户端。</p>
<p>而<code>token</code>和他们两个不同的是，<code>token</code>是无状态的，他不需要依赖<code>session</code>，即服务器不需要保存对<code>token</code>的记录，服务器只需要验证他的有效性即可。</p>
<p>此外，<code>session</code>和<code>cookie</code>很关键的问题就是跨域问题，因为产生的<code>session id</code>是依赖<code>session</code>的，所以不同<code>session</code>将导致登录认证失败。而<code>token</code>由于不依赖<code>session</code>所以完全可以实现<code>CORS(跨域资源共享)</code></p>
</blockquote>
<h4 id="权限验证">权限验证</h4>
<p>登录认证是对用户身份的认证，而权限认证则是在用户认证之后，对于该用户是否具有访问该接口或者执行该功能的权限的验证。</p>
<p>例如对于一个用户管理的系统，管理员具有对用户的<code>CRUD</code>的操作，而普通用户只具有查看的操作。所以当客户端发送请求的时候，我们就要验证该用户是否具有访问当前权限资源的权限。</p>
<p>往往我们将权限实现为权限资源，即对应的访问<code>url</code>（<code>/user/add</code>）和接口的请求<code>url</code>（<code>POST:/user/add</code>）</p>
<p>因此，我们将用户划分为几种不同的身份，例如超级管理员，管理员，普通用户等，每种身份对应不同的权限<code>id</code>，而每个权限<code>id</code>有对应其能访问的权限资源。</p>
<p>我们往往使用<code>Interceptor</code>进行权限验证，即每次向某个权限资源发出请求时，启动拦截器，获取用户的权限列表，验证该权限资源是否在用户权限列表当中，若不在则拒绝访问。</p>
<blockquote>
<p>拦截器</p>
<p>拦截器其实就是<code>AOP</code>的一种运用，就是在某个切入点执行一个通知。例如权限验证，调用方法前打印出字符串等等。</p>
<p>过滤器</p>
<p>过滤器是对传入<code>servlet</code>之前的<code>request</code>或者之后的<code>response</code>进行业务逻辑处理，例如过滤掉危险字符等等。</p>
</blockquote>
<h3 id="SpringSecurity">SpringSecurity</h3>
<p><code>springboot</code>这类安全框架对于<code>web</code>系统的支持其实就是提供<strong>基于一个个过滤组成的过滤器链</strong></p>
<img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210611145109.png" style="zoom: 67%;" />
<p>我们通过过滤器链中的过滤器完成相应的类似<strong>登录认证</strong>和<strong>权限验证</strong>的功能。</p>
<p><code>springsecurity</code>的具体操作便是在过滤器链中添加一个<code>FilterChainProxy</code>过滤器，这个代理过滤器会为服务器创建一套<code>springsecurity</code>自定义的过滤器链。</p>
<p>这样便会启用<code>springsecurity</code>默认的一些过滤器，类似<code>UsernamePasswordAuthenticationFilter</code>负责登录认证，<code>FilterSecurityInterceptor</code>负责权限授权。</p>
<h4 id="登录认证-v2">登录认证</h4>
<p>首先我们先介绍几个概念</p>
<hr>
<p><code>Authentication</code> ：<code>springsecurity</code>存储认证信息的组件，其中存储内容就是用户认证信息：</p>
<p>🔔<code>Principal</code> 用户信息，没有认证时一般是用户名，认证后一般是用户对象。</p>
<p>🔔<code>Credentials</code>用户凭证</p>
<p>🔔<code>Authorities</code>用户权限</p>
<p><code>SecurityContext</code>上下文对象，用来获取<code>Authentication</code></p>
<p><code>SecurityContextHolder</code>上下文管理对象，用来在程序任何地方获取<code>SecurityContext</code></p>
<hr>
<p>了解了这几个概念之后就很好理解<code>springsecurity</code>的认证流程了：</p>
<ul>
<li>
<p>初次登录验证（验证密码是否相同）</p>
</li>
<li>
<p>登录之后设置<code>authentication</code>，将其放入上下文中，代表该用户已登录。</p>
</li>
<li>
<p>之后发出其他请求时，如果用户上下文中存在<code>authentication</code>即代表已登录。</p>
</li>
</ul>
<p>了解了认证流程之后，我们具体来看下<code>springsecurity</code>是如何完成认证的：</p>
<p><code>spring security</code>使用<code>AuthenticationManager</code>组件进行登录认证，其校验逻辑非常简单：</p>
<ul>
<li>根据用户名查询出用户对象</li>
<li>将用户对象的密码与传入的密码进行校验</li>
</ul>
<p>这里<code>spring security</code>又提供了三个组件</p>
<hr>
<p><code>UserDetails</code> : 通过该接口告知系统我们的用户对象数据，提供了用户名，密码，权限等通用属性，<code>spring security</code>为我们提供了一个实现类<code>User</code>，以避免重写多余方法，我们只需要继承<code>User</code>类，调用其构造方法初始化用户名，密码，权限即可。</p>
<p><code>UserDetailsService</code> ：该接口提供<code>loadUserByusername</code>方法，用于通过用户名查询用户对象，我们只需要实现实现该接口，在<code>loadUserByusername()</code>完成我们的逻辑并返回<code>UserDetail</code>对象即可。</p>
<p><code>PasswordEncoder</code>：用于密码加密。</p>
<hr>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.caiwanghui.top/2021/06/15/SpringBoot%E6%95%B4%E5%90%88mybatis-plus/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Wanghui Cai">
      <meta itemprop="description" content="一些零零散散的学习总结">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="菜鸡肥肥的私人博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/15/SpringBoot%E6%95%B4%E5%90%88mybatis-plus/" class="post-title-link" itemprop="url">SpringBoot整合mybatis-plus</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-06-14 22:12:30 / 修改时间：14:41:33" itemprop="dateCreated datePublished" datetime="2021-06-14T22:12:30Z">2021-06-14</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>14k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>13 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>Springboot整合Mybatis-plus</h1>
<h3 id="简介">简介</h3>
<p><code>Mybatis-plus</code>是基于<code>mybatis</code>的纯粹的增强版，并没有修改<code>mybatis</code>任何功能，只是单纯的添加了一些非常方便的功能。</p>
<ul>
<li>类似<code>spring-data-jpa</code>，通过继承<code>BaseMapper</code>无须配置<code>xml</code>文件即可实现<code>CRUD</code>等操作</li>
<li>通过分页插件实现物理分页查询</li>
<li>通过继承<code>IService</code>和<code>ServiceImpl</code>实现例如批量更新等等操作</li>
<li>通过条件构造器简化查询</li>
<li>…</li>
</ul>
<p>总的来说就是简化了单表查询的操作，但是复杂的多表查询还是需要配置<code>mapper.xml</code>手动编写<code>sql</code>语句去实现。</p>
<p><code>mybatis-plus</code>是国内的开源插件，<a href="https://mybatis.plus/guide/" target="_blank" rel="noopener">官网</a>对于功能写的非常详细，我这里只是简单介绍一下几个常用的简单功能。</p>
<h3 id="使用示例">使用示例</h3>
<p><a href="https://github.com/bigmoom/springboot/tree/main/springboot%E6%95%B4%E5%90%88mybatis-plus" target="_blank" rel="noopener">程序源码</a></p>
<h4 id="pom-xml">pom.xml</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--连接mysql        --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">     <span class="comment">&lt;!--mybatis-plus        --&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.4.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="application-yml">application.yml</h4>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8090</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/springboot?characterEncoding=utf-8&amp;useSSL=false&amp;autoReconnect=true&amp;rewriteBatchedStatements=true&amp;serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">1234</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># mybatis-plus</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="comment">#驼峰</span></span><br><span class="line">    <span class="attr">map-underscore-to-camel-case:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment">#显示sql语句</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.cwh.springboot.springboot_mybatisplus.dao.entity</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*Mapper.xml</span></span><br></pre></td></tr></table></figure>
<p>和<code>mybatis</code>配置没有区别，基本就是设置数据库连接，设置实体类位置，设置<code>mapper.xml</code>匹配位置</p>
<h4 id="Entity">Entity</h4>
<p>这里还是只使用了<code>Customer</code>单个实体类</p>
<h5 id="Customer">Customer</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@TableName</span>(<span class="string">"customer"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line"><span class="comment">//    设置主键，主键生成策略</span></span><br><span class="line"><span class="comment">//    AUTO为数据库自增</span></span><br><span class="line">    <span class="meta">@TableId</span>(type = IdType.AUTO)</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//    @TableField(value="",exist=true)</span></span><br><span class="line"><span class="comment">//    映射非主键字段 value字段名 exist 标明该属性是否在数据库中</span></span><br><span class="line">    <span class="meta">@TableField</span>(value = <span class="string">"name"</span>)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableField</span>(value = <span class="string">"create_time"</span>,fill = FieldFill.INSERT)</span><br><span class="line"><span class="comment">//    fill 自动填充策略</span></span><br><span class="line"><span class="comment">//    INSERT 插入式填充，UPDATE 更新时填充,INSERT_UPDATE插入更新时填充</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@TableField</span>(value = <span class="string">"modify_time"</span>,fill = FieldFill.INSERT_UPDATE)</span><br><span class="line">    <span class="keyword">private</span> Date modifyTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>@TableName(&quot;customer&quot;)</code> 设置映射对应表名称</p>
<p><code>@TableId(type = IdType.AUTO)</code> 设置主键，<code>type</code>为主键策略</p>
<blockquote>
<table>
<thead>
<tr>
<th style="text-align:center">值</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">AUTO</td>
<td style="text-align:center">数据库ID自增</td>
</tr>
<tr>
<td style="text-align:center">NONE</td>
<td style="text-align:center">无状态,该类型为未设置主键类型(注解里等于跟随全局,全局里约等于 INPUT)</td>
</tr>
<tr>
<td style="text-align:center">INPUT</td>
<td style="text-align:center">insert前自行set主键值</td>
</tr>
<tr>
<td style="text-align:center">ASSIGN_ID</td>
<td style="text-align:center">分配ID(主键类型为Number(Long和Integer)或String)(since 3.3.0),使用接口<code>IdentifierGenerator</code>的方法<code>nextId</code>(默认实现类为<code>DefaultIdentifierGenerator</code>雪花算法)</td>
</tr>
<tr>
<td style="text-align:center">ASSIGN_UUID</td>
<td style="text-align:center">分配UUID,主键类型为String(since 3.3.0),使用接口<code>IdentifierGenerator</code>的方法<code>nextUUID</code>(默认default方法)</td>
</tr>
</tbody>
</table>
</blockquote>
<p><code>@TableField(value=&quot;name&quot;)</code>设置非主键字段映射字段名，可以设置多个属性</p>
<blockquote>
<p>这里介绍几个常用属性</p>
<table>
<thead>
<tr>
<th>属性</th>
<th>默认值</th>
<th>是否必须</th>
<th>描述</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>“”</td>
<td>否</td>
<td>数据库字段名</td>
</tr>
<tr>
<td>exist</td>
<td>false</td>
<td>否</td>
<td>是否为数据库字段名，false则不进行匹配</td>
</tr>
<tr>
<td>fill</td>
<td>FieldFill.DEFAULT</td>
<td>否</td>
<td>字段自动填充策略</td>
</tr>
</tbody>
</table>
<p>其中<code>FieldFill</code>通常用于自动添加<strong>创建时间</strong>，<strong>更新时间</strong></p>
<table>
<thead>
<tr>
<th style="text-align:center">值</th>
<th style="text-align:center">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">DEFAULT</td>
<td style="text-align:center">默认不处理</td>
</tr>
<tr>
<td style="text-align:center">INSERT</td>
<td style="text-align:center">插入时填充字段</td>
</tr>
<tr>
<td style="text-align:center">UPDATE</td>
<td style="text-align:center">更新时填充字段</td>
</tr>
<tr>
<td style="text-align:center">INSERT_UPDATE</td>
<td style="text-align:center">插入和更新时填充字段</td>
</tr>
</tbody>
</table>
</blockquote>
<h4 id="Config">Config</h4>
<p>由于我们要使用到<code>mybatis-plus</code>的分页插件，所以我们要设置一个配置类以添加插件</p>
<h5 id=MyBatisConfig>MyBatisConfig</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan</span>(<span class="string">"com.cwh.springboot.springboot_mybatisplus.dao.mapper"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MybatisPlusConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    设置分页插件（分页拦截器）</span></span><br><span class="line"><span class="comment">//    在每个需要分页的功能模块实现分页</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MybatisPlusInterceptor <span class="title">mybatisPlusInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        MybatisPlusInterceptor interceptor = <span class="keyword">new</span> MybatisPlusInterceptor();</span><br><span class="line">        interceptor.addInnerInterceptor(<span class="keyword">new</span> PaginationInnerInterceptor(DbType.MYSQL));</span><br><span class="line">        <span class="keyword">return</span> interceptor;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>@Configuration</code> 该注解标注在类上，以标明这是一个配置类，用来配置spring容器，配置类方法上标注<code>@Bean</code>将返回对象注册为<code>bean</code>对象。</p>
<p>我们这里是将<code>PaginationInnerInterceptor</code>添加到<code>MybatisInterceptor</code>中，并设置数据库类型为<code>mysql</code></p>
<p>这是一种拦截器策略，是一种典型的<code>AOP</code>实现，切入点为传入<code>Page</code>对象的方法。</p>
<p>即每次我们传入一个<code>Page</code>对象，就会调用分页插件进行分页。</p>
<h4 id="VO">VO</h4>
<p>与之前都一样，统一格式，没有什么什么区别</p>
<h5 id="ResultVO">ResultVO</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResultVO</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 状态码, 默认1000是成功</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> code;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 响应信息, 来说明响应情况</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 响应的具体数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ResultVO</span><span class="params">(T data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(ResultCode.SUCCESS, data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ResultVO</span><span class="params">(ResultCode resultCode, T data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.code = resultCode.getCode();</span><br><span class="line">        <span class="keyword">this</span>.msg = resultCode.getMsg();</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> String.format(<span class="string">"&#123;\"code\":%d,\"msg\":\"%s\",\"data\":\"%s\"&#125;"</span>, code, msg, data.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="RresultCode">RresultCode</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> ResultCode &#123;</span><br><span class="line"></span><br><span class="line">    SUCCESS(<span class="number">0000</span>, <span class="string">"操作成功"</span>),</span><br><span class="line"></span><br><span class="line">    UNAUTHORIZED(<span class="number">1001</span>, <span class="string">"没有登录"</span>),</span><br><span class="line"></span><br><span class="line">    FORBIDDEN(<span class="number">1002</span>, <span class="string">"没有相关权限"</span>),</span><br><span class="line"></span><br><span class="line">    VALIDATE_FAILED(<span class="number">1003</span>, <span class="string">"参数校验失败"</span>),</span><br><span class="line"></span><br><span class="line">    FAILED(<span class="number">1004</span>, <span class="string">"接口异常"</span>),</span><br><span class="line"></span><br><span class="line">    ERROR(<span class="number">5000</span>, <span class="string">"未知错误"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    ResultCode(<span class="keyword">int</span> code, String msg) &#123;</span><br><span class="line">        <span class="keyword">this</span>.code = code;</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="CustomerVO">CustomerVO</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerVO</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty</span>(value = <span class="string">"creat_time"</span>)</span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="meta">@JsonProperty</span>(value = <span class="string">"modify_time"</span>)</span><br><span class="line">    <span class="keyword">private</span> Date modifyTime;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomerVO</span><span class="params">()</span></span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomerVO</span><span class="params">(Customer customer)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.age = customer.getAge();</span><br><span class="line">        <span class="keyword">this</span>.name = customer.getName();</span><br><span class="line">        <span class="keyword">this</span>.id = customer.getId();</span><br><span class="line">        <span class="keyword">this</span>.createTime = customer.getCreateTime();</span><br><span class="line">        <span class="keyword">this</span>.modifyTime = customer.getModifyTime();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意事项：</p>
<p>实体类中如果有有参构造器，则无参构造器必须显示给出，否则程序不会调用无参构造器</p>
</blockquote>
<p>这次使用了一个<code>ControllerAdvice</code>进行返回数据的统一处理，统一返回为<code>ResultVO</code>格式</p>
<h5 id="ResponseControllerAdvice">ResponseControllerAdvice</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span>(</span><br><span class="line">    basePackages = &#123;<span class="string">"com.cwh.springboot.springboot_mybatisplus.controller"</span>&#125;)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResponseControllerAdvice</span>  <span class="keyword">implements</span> <span class="title">ResponseBodyAdvice</span>&lt;<span class="title">Object</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断是否调用beforeBodyWrite,false为不调用</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> returnType</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> aClass</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">supports</span><span class="params">(MethodParameter returnType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; aClass)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        若返回类型已经是ResultVO,则不调用</span></span><br><span class="line">        <span class="keyword">return</span> !returnType.getParameterType().equals(ResultVO<span class="class">.<span class="keyword">class</span>)</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">beforeBodyWrite</span><span class="params">(Object data, MethodParameter returnType, MediaType mediaType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; aClass, ServerHttpRequest serverHttpRequest, ServerHttpResponse serverHttpResponse)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// String类型不能直接包装，所以要进行些特别的处理</span></span><br><span class="line">        <span class="keyword">if</span> (returnType.getGenericParameterType().equals(String<span class="class">.<span class="keyword">class</span>)) </span>&#123;</span><br><span class="line">            ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// 将数据包装在ResultVO里后，再转换为json字符串响应给前端</span></span><br><span class="line">                <span class="keyword">return</span> objectMapper.writeValueAsString(<span class="keyword">new</span> ResultVO&lt;&gt;(data));</span><br><span class="line">            &#125; <span class="keyword">catch</span> (JsonProcessingException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> ApiException(<span class="string">"返回String类型错误"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 将原本的数据包装在ResultVO里</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResultVO&lt;&gt;(data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>@RestControllerAdvice</code>作为特化<code>@Component</code>，允许通过类路径扫描自动检测实现类。通常用于：</p>
<ul>
<li>全局异常处理（<code>@ExceptionHandler</code>）</li>
<li>全局数据绑定（<code>@InitBinder</code>）</li>
<li>全局数据预处理（<code>@ModelAttribute</code>）</li>
</ul>
<p>这里我们用于扫描所有的<code>controller</code>，实现<code>ResponseBodyAdvice&lt;Object&gt;</code>实现返回数据的统一处理。</p>
<p>该接口有两个方法：</p>
<ul>
<li>
<p><code>support(MethodParameter returnType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; aClass)</code></p>
<p>第一个参数为返回数据类型，第二个参数为最终将会使用的消息转换器。</p>
<p>返回结果决定是否调用<code>beforeBodyWrite</code>，<code>false</code>不调用，<code>true</code>调用</p>
</li>
<li>
<p><code>beforeBodyWrite(Object data, MethodParameter returnType, MediaType mediaType, Class&lt;? extends HttpMessageConverter&lt;?&gt;&gt; aClass, ServerHttpRequest serverHttpRequest, ServerHttpResponse serverHttpResponse) </code></p>
<p><code>data</code> 返回数据</p>
<p><code>returnType</code> 返回数据类型</p>
<p><code>mediaType</code> 响应的<code>ContentType</code></p>
<p><code>aclass</code> 最终将会使用的消息转换器</p>
<p>返回为修改后的数据类型。</p>
</li>
</ul>
<h4 id="Mapper">Mapper</h4>
<h5 id="CustomerMapper">CustomerMapper</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CustomerMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">Customer</span>&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    分页查询</span></span><br><span class="line">    <span class="function">IPage&lt;CustomerVO&gt; <span class="title">selectPage</span><span class="params">(Page&lt;CustomerVO&gt; page, @Param(Constants.WRAPPER)</span>Wrapper&lt;CustomerVO&gt; Wrapper)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Integer <span class="title">addCustomer</span><span class="params">(@Param(<span class="string">"customer"</span>)</span>Customer customer)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;Customer&gt; <span class="title">selectByAge</span><span class="params">(@Param(<span class="string">"ew"</span>)</span>Wrapper&lt;Customer&gt; Wrapper)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="CustomerMapper-xml">CustomerMapper.xml</h5>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.cwh.springboot.springboot_mybatisplus.dao.mapper.CustomerMapper"</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">&lt;!--    分页查询--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectPage"</span> <span class="attr">resultType</span>=<span class="string">"com.cwh.springboot.springboot_mybatisplus.vo.CustomerVO"</span>&gt;</span></span><br><span class="line">        select</span><br><span class="line">            *</span><br><span class="line">        from</span><br><span class="line">            `customer`</span><br><span class="line">        $&#123;ew.customSqlSegment&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    添加用户--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"addCustomer"</span> <span class="attr">parameterType</span>=<span class="string">"Customer"</span>&gt;</span></span><br><span class="line">        insert</span><br><span class="line">        into</span><br><span class="line">            `customer`(name,age)</span><br><span class="line">            values (#&#123;customer.name&#125;, #&#123;customer.age&#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--    使用条件构造器查询--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"selectByAge"</span> <span class="attr">resultType</span>=<span class="string">"Customer"</span>&gt;</span></span><br><span class="line">        select</span><br><span class="line">            *</span><br><span class="line">        from</span><br><span class="line">            `customer`</span><br><span class="line">        $&#123;ew.customSqlSegment&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>CustomerMapper</code>实现了<code>mybatis-plus</code>的几个非常常用的功能</p>
<h5 id="CRUD接口">CRUD接口</h5>
<h6 id="Mapper-CRUD接口">Mapper CRUD接口</h6>
<p><code>mybatis-plus</code>为我们提供了封装好的<code>BaseMapper</code>，通过继承<code>BaseMapper</code>即能够实现简单的<code>CRUD</code>操作</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BaseMapper</span>&lt;<span class="title">T</span>&gt; <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">T</span>&gt; </span>&#123; </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(T entity)</span></span>; </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteById</span><span class="params">(Serializable id)</span></span>; </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteByMap</span><span class="params">(@Param(<span class="string">"cm"</span>)</span> Map&lt;String, Object&gt; columnMap)</span>; </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">delete</span><span class="params">(@Param(<span class="string">"ew"</span>)</span> Wrapper&lt;T&gt; wrapper)</span>; </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteBatchIds</span><span class="params">(@Param(<span class="string">"coll"</span>)</span> Collection&lt;? extends Serializable&gt; idList)</span>; </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateById</span><span class="params">(@Param(<span class="string">"et"</span>)</span> T entity)</span>; </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">update</span><span class="params">(@Param(<span class="string">"et"</span>)</span> T entity, @<span class="title">Param</span><span class="params">(<span class="string">"ew"</span>)</span> Wrapper&lt;T&gt; updateWrapper)</span>; </span><br><span class="line">    <span class="function">T <span class="title">selectById</span><span class="params">(Serializable id)</span></span>; </span><br><span class="line">    <span class="function">List&lt;T&gt; <span class="title">selectBatchIds</span><span class="params">(@Param(<span class="string">"coll"</span>)</span> Collection&lt;? extends Serializable&gt; idList)</span>; </span><br><span class="line">    <span class="function">List&lt;T&gt; <span class="title">selectByMap</span><span class="params">(@Param(<span class="string">"cm"</span>)</span> Map&lt;String, Object&gt; columnMap)</span>; </span><br><span class="line">    <span class="function">T <span class="title">selectOne</span><span class="params">(@Param(<span class="string">"ew"</span>)</span> Wrapper&lt;T&gt; queryWrapper)</span>; </span><br><span class="line">    <span class="function">Integer <span class="title">selectCount</span><span class="params">(@Param(<span class="string">"ew"</span>)</span> Wrapper&lt;T&gt; queryWrapper)</span>; </span><br><span class="line">    <span class="function">List&lt;T&gt; <span class="title">selectList</span><span class="params">(@Param(<span class="string">"ew"</span>)</span> Wrapper&lt;T&gt; queryWrapper)</span>; </span><br><span class="line">    List&lt;Map&lt;String, Object&gt;&gt; selectMaps(<span class="meta">@Param</span>(<span class="string">"ew"</span>) Wrapper&lt;T&gt; queryWrapper); </span><br><span class="line">    <span class="function">List&lt;Object&gt; <span class="title">selectObjs</span><span class="params">(@Param(<span class="string">"ew"</span>)</span> Wrapper&lt;T&gt; queryWrapper)</span>; </span><br><span class="line">    &lt;E extends IPage&lt;T&gt;&gt; <span class="function">E <span class="title">selectPage</span><span class="params">(E page, @Param(<span class="string">"ew"</span>)</span> Wrapper&lt;T&gt; queryWrapper)</span>; </span><br><span class="line">    &lt;E extends IPage&lt;Map&lt;String, Object&gt;&gt;&gt; <span class="function">E <span class="title">selectMapsPage</span><span class="params">(E page, @Param(<span class="string">"ew"</span>)</span> Wrapper&lt;T&gt; queryWrapper)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以直接调用上述方法而不用编写<code>mapper.xml</code></p>
</blockquote>
<h6 id="Service-CRUD-接口">Service CRUD 接口</h6>
<p><code>mybatis-plus</code>还为我们提供了封装好的<code>IService</code>接口，进一步提供<code>get</code>,<code>list</code>,<code>remove</code>,<code>page</code>等操作，想要仔细了解可以查看官方文档或者之间查看源码。</p>
<blockquote>
<p><code>BaseMapper</code>中一些以<code>entity</code>为参数传入时，<code>NOT NULL</code>的实体属性必须不能为空，不会调用自动填充功能。</p>
</blockquote>
<h5 id="分页插件">分页插件</h5>
<p><code>mybatis-plus</code>为我们提供了非常简单的分页插件。</p>
<p><code>[MybatisPlusConfig]</code>的<a href="#MyBatisConfig">配置</a>已经在上文给出，之后我们只需要编写我们的分页查询功能即可。</p>
<p><code>selectPage(page,wrapper)</code>：第一个参数为一个<code>page</code>对象,第二个为一个查询构造器。</p>
<blockquote>
<p>这里的page对象和之前<code>springframwork.data.domain</code>中的<code>page</code>对象类似，但是不同。</p>
<p>我们一样可以通过<code>page(current,pagesize)</code>构建一个<code>page</code>对象，但是此处<code>current</code>从1开始，表示当前所在页码。</p>
<p><code>page.addOrder(List&lt;OrderItem&gt; items)</code>添加排序序列</p>
</blockquote>
<h5 id="条件构造器">条件构造器</h5>
<p><code>mybatis-plus</code>提供了条件构造器<code>AbstractWrapper,QueryWrapper,UpdateWrapper</code>用于生成<code>sql</code>中<code>where</code>条件。</p>
<p>这里简单介绍几个常用功能</p>
<ul>
<li>
<p><code>QueryWrapper</code>继承<code>AbstractWrapper</code>主要用于查询</p>
<p><code>eq</code> <code>querrywrapper.eq(&quot;name&quot;,&quot;cwh&quot;)</code>即等于<code>where name = cwh</code></p>
<p><code>ge</code> <code>querrywrapper.ge(&quot;age&quot;,&quot;24&quot;)</code>即等于<code>where age &gt;= 24</code></p>
<p><code>between</code> <code>querrywrapper.between(&quot;age&quot;,&quot;24&quot;,&quot;26&quot;)</code> 即等于 <code>where age between 24 and 26 </code></p>
<p><code>like</code> <code>querrywrapper.like(&quot;name&quot;,&quot;王&quot;)</code>即等于 <code>where name like %王%</code></p>
<p><code>orderByAsc</code> <code>querrywrapper.orderByAsc(&quot;age&quot;,&quot;id&quot;)</code>即等于 <code>order by age ASC id ASC</code></p>
</li>
<li>
<p><code>UpdateWrapper</code>继承<code>AbstractWrapper</code>提供了<code>set</code>方法，用于赋值更新</p>
</li>
<li>
<p><code>LambdaQueryWrapper</code>和<code>LambdaUpdateWrapper</code>功能与上述两个没有区别，只是参数使用<code>lambda</code>格式</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//	王姓，年龄小于40，邮箱不为空	LambdaQueryWrapper&lt;User&gt; wq = Wrappers.&lt;User&gt;lambdaQuery();	wq.like(User::getName, "张").and(user -&gt; user.lt(User::getAge, 40).or().isNotNull(User::getEmail));</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>使用注意事项</p>
<p>需要<code>mybatis-plus</code>版本 &gt;= <code>3.0.7</code></p>
<p>param 参数名要么叫<code>ew</code>,要么加上注解<code>@Param(Constants.WRAPPER)</code> ，<code>mapper.xml</code> 中 使用<code>${ew.customSqlSegment}</code>匹配</p>
</blockquote>
<h4 id="Service">Service</h4>
<h5 id="CustomerService">CustomerService</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CustomerService</span> <span class="keyword">extends</span> <span class="title">IService</span>&lt;<span class="title">Customer</span>&gt; </span>&#123;</span><br><span class="line"><span class="comment">//  分页</span></span><br><span class="line">    <span class="function">IPage&lt;CustomerVO&gt; <span class="title">selectPage</span><span class="params">(Page&lt;CustomerVO&gt; page)</span></span>;</span><br><span class="line"><span class="comment">//  添加用户</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">addCustomer</span><span class="params">(Customer customer)</span></span>;</span><br><span class="line"><span class="comment">//  通过用户id查询</span></span><br><span class="line">    <span class="function">Customer <span class="title">getCustomerById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"><span class="comment">//  通过用户id删除</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line"><span class="comment">//  更新</span></span><br><span class="line">    <span class="function">Integer <span class="title">updateCustomer</span><span class="params">(Customer customer)</span></span>;</span><br><span class="line"><span class="comment">//  查询大于age1,小于age2的用户</span></span><br><span class="line">    <span class="function">List&lt;Customer&gt; <span class="title">selectByAge</span><span class="params">(Integer age1,Integer age2)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="CustomerServiceImpl">CustomerServiceImpl</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerServiceImpl</span> <span class="keyword">extends</span> <span class="title">ServiceImpl</span>&lt;<span class="title">CustomerMapper</span>, <span class="title">Customer</span>&gt; <span class="keyword">implements</span> <span class="title">CustomerService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> IPage&lt;CustomerVO&gt; <span class="title">selectPage</span><span class="params">(Page&lt;CustomerVO&gt; page)</span> </span>&#123;</span><br><span class="line"><span class="comment">//        设置条件构造器</span></span><br><span class="line">        QueryWrapper&lt;CustomerVO&gt; queryWrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">        <span class="keyword">return</span> baseMapper.selectPage(page,queryWrapper);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addCustomer</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">        baseMapper.addCustomer(customer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Customer <span class="title">getCustomerById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> baseMapper.selectById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        baseMapper.deleteById(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">updateCustomer</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> baseMapper.updateById(customer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Customer&gt; <span class="title">selectByAge</span><span class="params">(Integer age1,Integer age2)</span> </span>&#123;</span><br><span class="line">        QueryWrapper&lt;Customer&gt; queryWrapper = <span class="keyword">new</span> QueryWrapper&lt;Customer&gt;();</span><br><span class="line">        queryWrapper.between(<span class="string">"age"</span>,age1,age2);</span><br><span class="line">        queryWrapper.orderByAsc(<span class="string">"age"</span>);</span><br><span class="line">        <span class="keyword">return</span> baseMapper.selectByAge(queryWrapper);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>CustomerServiceImpl</code>继承了<code>mybatis-plus</code>提供的通用实现类<code>ServiceImpl&lt;CustomerMapper,Custome&gt;</code>并且实现了自己定义的<code>CustomerService</code></p>
<p>所以不用再注入<code>dao</code>层，因为<code>SeviceImpl</code>中已经为我们实现了注入</p>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServiceImpl</span>&lt;<span class="title">M</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">T</span>&gt;, <span class="title">T</span>&gt; <span class="keyword">implements</span> <span class="title">IService</span>&lt;<span class="title">T</span>&gt; </span>&#123; <span class="meta">@Autowired</span> <span class="keyword">protected</span> M baseMapper; ....</span><br></pre></td></tr></table></figure>
</blockquote>
<p>所以我们可以通过<code>baseMapper</code>直接调用<code>baseMapper</code>和我们定义的<code>CustomerMapper</code>中的方法</p>
<h4 id="Controller">Controller</h4>
<h5 id="CustomerController">CustomerController</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/customer"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CustomerService customerService;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    分页查询</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/page/&#123;current&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> IPage&lt;CustomerVO&gt; <span class="title">getPage</span><span class="params">(@PathVariable(<span class="string">"current"</span>)</span><span class="keyword">int</span> current)</span>&#123;</span><br><span class="line"><span class="comment">//        分页参数（为mybatis-plus中page，与springdata domain中不同）</span></span><br><span class="line"><span class="comment">//        传入当前</span></span><br><span class="line">        Page&lt;CustomerVO&gt; page = <span class="keyword">new</span> Page&lt;&gt;(current,<span class="number">5</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        设置排序序列</span></span><br><span class="line">        OrderItem orderItem = <span class="keyword">new</span> OrderItem();</span><br><span class="line">        orderItem.setColumn(<span class="string">"create_time"</span>);</span><br><span class="line"><span class="comment">//        倒叙排列</span></span><br><span class="line">        orderItem.setAsc(<span class="keyword">false</span>);</span><br><span class="line">        page.addOrder(orderItem);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> customerService.selectPage(page);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    添加用户</span></span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/add"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(@RequestParam(<span class="string">"name"</span>)</span>String name, @<span class="title">RequestParam</span><span class="params">(<span class="string">"age"</span>)</span>Integer age)</span>&#123;</span><br><span class="line">        Customer customer = <span class="keyword">new</span> Customer();</span><br><span class="line">        customer.setName(name);</span><br><span class="line">        customer.setAge(age);</span><br><span class="line">        customerService.addCustomer(customer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    查询</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/get"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> CustomerVO <span class="title">getCustomerById</span><span class="params">(@RequestParam(<span class="string">"id"</span>)</span>Integer id)</span>&#123;</span><br><span class="line">        Customer customer = customerService.getCustomerById(id);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> CustomerVO(customer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    根据年龄大小查询</span></span><br><span class="line">    <span class="meta">@GetMapping</span>(value = <span class="string">"/get"</span>, params = &#123;<span class="string">"age1"</span>,<span class="string">"age2"</span>&#125;)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Customer&gt; <span class="title">selectCustomerByAge</span><span class="params">(@RequestParam(<span class="string">"age1"</span>)</span>Integer age1, @<span class="title">RequestParam</span><span class="params">(<span class="string">"age2"</span>)</span>Integer age2)</span>&#123;</span><br><span class="line">        List&lt;Customer&gt; customerList = customerService.selectByAge(age1, age2);</span><br><span class="line">        <span class="keyword">return</span> customerList;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    删除</span></span><br><span class="line">    <span class="meta">@DeleteMapping</span>(<span class="string">"/delete"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">deleteById</span><span class="params">(@RequestParam(<span class="string">"id"</span>)</span>Integer id)</span>&#123;</span><br><span class="line">        customerService.deleteById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="运行结果">运行结果</h4>
<h5 id="GET-customer-page-current"><code>GET</code> <code>/customer/page/{current}</code></h5>
<img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210609180015.png" style="zoom:80%;" />
<img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210609180043.png" style="zoom:80%;" />
<h5 id="POST-add"><code>POST</code> <code>/add</code></h5>
<img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210609180233.png" style="zoom:80%;" />
<h5 id="GET-get"><code>GET</code> <code>/get</code></h5>
<img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210609180420.png" style="zoom:80%;" />
<h5 id="GET-get-age1-age2"><code>GET</code> <code>/get?age1=?&amp;age2=?</code></h5>
<img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210609180324.png" style="zoom:80%;" />
<h5 id="DELETE-delete"><code>DELETE</code> <code>/delete</code></h5>
<img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210609180456.png" style="zoom:80%;" />
<h3 id="总结">总结</h3>
<p>个人感觉<code>mybaits-plus</code>更像是<code>spring data jpa</code>与<code>mybatis</code>的结合升级版。</p>
<p>他提供了简单的<code>CRUD</code>和分页的接口，也可以根据复杂需求使用原生<code>sql</code>语句。可以实现非常强大的功能。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.caiwanghui.top/2021/06/15/SpringBoot%E6%95%B4%E5%90%88mybatis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Wanghui Cai">
      <meta itemprop="description" content="一些零零散散的学习总结">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="菜鸡肥肥的私人博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/15/SpringBoot%E6%95%B4%E5%90%88mybatis/" class="post-title-link" itemprop="url">SpringBoot整合mybatis</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-06-14 22:12:25 / 修改时间：14:36:20" itemprop="dateCreated datePublished" datetime="2021-06-14T22:12:25Z">2021-06-14</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>9.7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>9 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>Springboot 整合 Mybatis</h1>
<h3 id="简介">简介</h3>
<blockquote>
<p><code>MyBatis</code> 是一款优秀的持久层框架，它支持自定义 <code>SQL</code>、存储过程以及高级映射。</p>
<p><code>MyBatis</code> 免除了几乎所有的 JDBC 代码以及设置参数和获取结果集的工作。</p>
<p><code>MyBatis</code> 可以通过简单的 XML 或注解来配置和映射原始类型、接口和 <code>Java POJO（Plain Old Java Objects)</code>为数据库中的记录。</p>
</blockquote>
<p>简单来说，<code>mybatis</code>作用和之前<code>spring data jpa</code>类似，都是实现数据库中数据与实体类的映射。</p>
<h3 id="使用示例">使用示例</h3>
<p><a href="https://github.com/bigmoom/springboot/tree/main/springboot%E6%95%B4%E5%90%88mybatis" target="_blank" rel="noopener">程序源码</a></p>
<h5 id="建表">建表</h5>
<p>我们这里首先简单构建<code>customer</code>表，该表有<code>id</code>,<code>name</code>,<code>age</code>,<code>create_time</code>,<code>modify_time</code>属性，其中主键为<code>id</code>，递增。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`customer`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`customer`</span>(</span><br><span class="line"><span class="string">`id`</span> <span class="built_in">BIGINT</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'id'</span>,</span><br><span class="line"><span class="string">`name`</span> <span class="built_in">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'姓名'</span>,</span><br><span class="line"><span class="string">`age`</span> <span class="built_in">SMALLINT</span>(<span class="number">3</span>)  <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'年龄'</span> ,</span><br><span class="line"><span class="string">`create_time`</span> <span class="built_in">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">'创建时间'</span>,</span><br><span class="line"><span class="string">`modify_time`</span> <span class="built_in">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">'更新时间'</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span>(<span class="string">`id`</span>)</span><br><span class="line">)<span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure>
<h4 id="pom-xml">pom.xml</h4>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--数据库连接--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--mybatis--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="application-yml">application.yml</h4>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8090</span></span><br><span class="line"></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/customer?useUnicode=true&amp;characterEncoding=utf-8&amp;allowMultiQueries=true&amp;serverTimezone=GMT%2B8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">1234</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="comment">#设置实体类包名，这样mapper.xml中就可以使用实体类类名</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.cwh.springboot.springboot_mybatis.dao.entity</span></span><br><span class="line">  <span class="comment">#设置mapper存放位置,匹配以Mapper.xml结束的文件</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*Mapper.xml</span></span><br><span class="line">  <span class="comment">#开启驼峰匹配</span></span><br><span class="line"><span class="comment">#  configuration:</span></span><br><span class="line"><span class="comment">#    map-underscore-to-camel-case: true</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里虽然说是添加了<code>type-aliases-package</code>，但是实际使用时<code>mapper.xml</code>还是会识别不到实体类，所以添加<code>resources/mapper/Util.xml</code>工具配置文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span> <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-config.dtd"</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment"> 注意: 这个配置文件并不会被实际使用到, 写这个文件仅仅是为了让 IDEA 的 Mybatis 插件找到实体类的位置</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"com.cwh.springboot.springboot_mybatis.dao.entity"</span>/&gt;</span> <span class="comment">&lt;!--替换成你的项目的实体类的路径--&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="Entity">Entity</h4>
<p>因为这次只是简单介绍<code>mybatis</code>的<code>CRUD</code>操作，所以还是使用单个<code>Customer</code>实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="keyword">private</span> Date modifyTime;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="VO">VO</h4>
<h5 id="ResultVO">ResultVO</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@JsonInclude</span>(JsonInclude.Include.NON_NULL)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResultVO</span>&lt;<span class="title">T</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ResultVO</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(ResultCode.SUCCESS, <span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ResultVO</span><span class="params">(T data)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(ResultCode.SUCCESS, data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ResultVO</span><span class="params">(ResultCode resultCode,T data)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.code = resultCode.getCode();</span><br><span class="line">        <span class="keyword">this</span>.msg = resultCode.getMsg();</span><br><span class="line">        <span class="keyword">this</span>.data = data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="CustomerVO">CustomerVO</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerVO</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> Date createDt;</span><br><span class="line">    <span class="keyword">private</span> Date modifyDt;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomerVO</span><span class="params">(Customer customer)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = customer.getId();</span><br><span class="line">        <span class="keyword">this</span>.name = customer.getName();</span><br><span class="line">        <span class="keyword">this</span>.age = customer.getAge();</span><br><span class="line">        <span class="keyword">this</span>.createDt = customer.getCreateTime();</span><br><span class="line">        <span class="keyword">this</span>.modifyDt = customer.getModifyTime();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这次我使用了一个枚举类<code>ResultCode</code>以集中设置我的返回信息码和信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> ResultCode &#123;</span><br><span class="line"></span><br><span class="line">    SUCCESS(<span class="number">0000</span>,<span class="string">"操作成功"</span>),</span><br><span class="line">    <span class="comment">//其余为权限验证，登录验证时候使用，暂时没有用到</span></span><br><span class="line">    UNAUTHORIZED(<span class="number">1001</span>,<span class="string">"没有登录"</span>),</span><br><span class="line">    FORBIDDEN(<span class="number">1002</span>,<span class="string">"没有权限"</span>),</span><br><span class="line">    VALIDATE_FAILED(<span class="number">1003</span>,<span class="string">"参数校验失败"</span>),</span><br><span class="line">    FAILED(<span class="number">1004</span>,<span class="string">"接口异常"</span>),</span><br><span class="line">    ERROR(<span class="number">1005</span>,<span class="string">"未知错误"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> code;</span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    ResultCode(<span class="keyword">int</span> code, String msg)&#123;</span><br><span class="line">        <span class="keyword">this</span>.code=code;</span><br><span class="line">        <span class="keyword">this</span>.msg=msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Mapper">Mapper</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CustomerMapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;Customer&gt; <span class="title">getAllCustomer</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Customer <span class="title">getCustomerByName</span><span class="params">(@Param(<span class="string">"name"</span>)</span> String name)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Integer <span class="title">addCustomer</span><span class="params">(@Param(<span class="string">"customer"</span>)</span> Customer customer)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Integer <span class="title">updateCustomer</span><span class="params">(@Param(<span class="string">"customer"</span>)</span> Customer customer)</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Integer <span class="title">deleteAllCustomer</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Integer <span class="title">deleteCustomerById</span><span class="params">(@Param(<span class="string">"id"</span>)</span>Integer id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>mybatis</code>中使用<code>mapper</code>进行实体类与数据库数据的映射</p>
<ol>
<li>
<p>我们创建<code>Mapper</code>接口（使用<code>@Mapper</code>标识），定义相关功能方法。</p>
<blockquote>
<p>方法中若有多个参数，使用<code>@Param(&quot;&quot;)</code>标识参数名称，若只有一个参数可以不用添加。</p>
<p>可以在启动类上添加<code>@MapperScan(&quot;mapper放置的位置&quot;)</code>省去<code>@Mapper</code>注释</p>
</blockquote>
</li>
<li>
<p>创建与<code>Mapper</code>接口对应的<code>mapper.xml</code>文件</p>
<blockquote>
<p><code>mapper.xml</code>文件一般建立在<code>main/resources/mapper</code>中</p>
</blockquote>
</li>
</ol>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" ?&gt;</span><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span>        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">"-//mybatis.org//DTD Config 3.0//EN"</span>        <span class="meta-string">"http://mybatis.org/dtd/mybatis-3-mapper.dtd"</span>&gt;</span><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">"com.cwh.springboot.springboot_mybatis.dao.mapper.CustomerMapper"</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    构建映射map--&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span> =<span class="string">"CustomerMap"</span> <span class="attr">type</span>=<span class="string">"com.cwh.springboot.springboot_mybatis.dao.entity.Customer"</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--   id标明为主键 column标明数据库中对应列明 property标明实体类中属性 --&gt;</span>        </span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">"id"</span> <span class="attr">property</span>=<span class="string">"id"</span> <span class="attr">javaType</span>=<span class="string">"Long"</span> /&gt;</span>        </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"name"</span> <span class="attr">property</span>=<span class="string">"name"</span> <span class="attr">javaType</span>=<span class="string">"String"</span> /&gt;</span>        </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"age"</span> <span class="attr">property</span>=<span class="string">"age"</span> <span class="attr">javaType</span>=<span class="string">"Integer"</span>/&gt;</span>        </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"create_time"</span> <span class="attr">property</span>=<span class="string">"createTime"</span> <span class="attr">javaType</span>=<span class="string">"Date"</span> /&gt;</span>        </span><br><span class="line">        <span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">"modify_time"</span> <span class="attr">property</span>=<span class="string">"modifyTime"</span> <span class="attr">javaType</span>=<span class="string">"Date"</span>/&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--    自定义sql语句，避免重复使用--&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">sql</span> <span class="attr">id</span>=<span class="string">"Customer_po"</span>&gt;</span>        id , name ,age    <span class="tag">&lt;/<span class="name">sql</span>&gt;</span>    </span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getAllCustomer"</span> <span class="attr">resultMap</span>=<span class="string">"CustomerMap"</span>&gt;</span>        </span><br><span class="line">        select * from customer;    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span>    </span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">"getCustomerByName"</span> <span class="attr">resultMap</span>=<span class="string">"CustomerMap"</span> <span class="attr">parameterType</span>=<span class="string">"java.lang.String"</span>&gt;</span>        </span><br><span class="line">        select * from customer where name=#&#123;name&#125;;    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span>    </span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"addCustomer"</span>  <span class="attr">parameterType</span>=<span class="string">"Customer"</span>&gt;</span>        </span><br><span class="line">        insert into customer (name, age ,create_time,modify_time)        </span><br><span class="line">        values(#&#123;customer.name&#125;,#&#123;customer.age&#125;,now(),now());    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">insert</span>&gt;</span>    </span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">update</span> <span class="attr">id</span>=<span class="string">"updateCustomer"</span> <span class="attr">parameterType</span>=<span class="string">"Customer"</span>&gt;</span>        </span><br><span class="line">        update customer        </span><br><span class="line">        set name =#&#123;customer.name&#125;,age =#&#123;customer.age&#125;,modify_time =now()       </span><br><span class="line">        where id = #&#123;customer.id&#125;;    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">update</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteAllCustomer"</span> &gt;</span>        </span><br><span class="line">        delete from customer;    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span>    </span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">delete</span> <span class="attr">id</span>=<span class="string">"deleteCustomerById"</span>  <span class="attr">parameterType</span>=<span class="string">"Integer"</span>&gt;</span>        </span><br><span class="line">        delete from customer where id=#&#123;id&#125;;    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">delete</span>&gt;</span><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><code>&lt;mapper namespace=...&gt;</code>：为该<code>mapper.xml</code>对应的<code>mapper</code>接口的地址</p>
<p><code>&lt;resultMap&gt;&lt;/resultMap&gt;</code>：为一个映射对象，我们在这里面实现映射</p>
<p>​	<code>type</code>：为对应实体类</p>
<p>​	<code>&lt;id  &gt;</code> : 数据库中主键</p>
<p>​	<code>column</code>：数据库中对应列名</p>
<p>​	<code>property</code>：对应实体类属性</p>
<p>​	<code>javaType</code>：对应属性类型</p>
<p><code>&lt;sql id=&quot;name&quot;&gt;&lt;/sql&gt;</code>：定义sql语句，后面可以使用<code>&lt;include refid=&quot;name&quot;/&gt;</code>引入，避免重复使用</p>
<p><code>&lt;select/update/delete/insert&gt;</code>：即标明对应的<code>CRUD</code>操作，内容为具体的<code>sql</code>语句</p>
<p>​	<code>id</code> ：对应<code>mapper</code>接口中方法名字</p>
<p>​	<code>parameterType</code>：参数类型</p>
<p>​	<code>resultType</code>：返回类型</p>
<p>​	<code>resultMap</code>：也是返回映射关系，用于返回一个实体类</p>
<blockquote>
<p><code>resultType</code> 一般用于返回单个值，也可以返回实体类，但需要开启驼峰匹配</p>
</blockquote>
<p>​	<code>#{name}</code>：传参</p>
<blockquote>
<p>传入的是实体类对象时，使用<code>#{customer.age}</code>传入属性值</p>
</blockquote>
<h4 id="Service">Service</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CustomerService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Customer&gt; <span class="title">getAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Customer <span class="title">searchByName</span><span class="params">(String name)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">add</span><span class="params">(Customer customer)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">update</span><span class="params">(Customer customer)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">deleteAll</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">deleteById</span><span class="params">(Integer id)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ServiceImpl">ServiceImpl</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerServiceImpl</span> <span class="keyword">implements</span> <span class="title">CustomerService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CustomerMapper customerMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Customer&gt; <span class="title">getAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> customerMapper.getAllCustomer();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Customer <span class="title">searchByName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> customerMapper.getCustomerByName(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">add</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> customerMapper.addCustomer(customer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">update</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> customerMapper.updateCustomer(customer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">deleteAll</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> customerMapper.deleteAllCustomer();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">deleteById</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> customerMapper.deleteCustomerById(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>serviceimpl</code>还是和<code>spring-data-jpa</code>类似，注入<code>Dao</code>层映射对象，调用<code>mapper</code>完成相应操作</p>
<h4 id="Controller">Controller</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/customer"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerController</span> </span>&#123;    </span><br><span class="line">    <span class="meta">@Autowired</span>    </span><br><span class="line">    <span class="keyword">private</span> CustomerService customerService;    </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"getall"</span>)    </span><br><span class="line">    <span class="keyword">public</span> ResultVO&lt;List&lt;Customer&gt;&gt; getAll()&#123;        </span><br><span class="line">        List&lt;Customer&gt; customerArrayList = customerService.getAll();        </span><br><span class="line">        LinkedList&lt;CustomerVO&gt; customerVOLinkedList = <span class="keyword">new</span> LinkedList();        </span><br><span class="line">        <span class="keyword">for</span>(Customer customer:customerArrayList)&#123;            </span><br><span class="line">            CustomerVO customerVO = <span class="keyword">new</span> CustomerVO(customer);            </span><br><span class="line">            customerVOLinkedList.add(customerVO);        </span><br><span class="line">        &#125;        </span><br><span class="line">        </span><br><span class="line">        ResultVO&lt;List&lt;Customer&gt;&gt; resultVO = <span class="keyword">new</span> ResultVO(customerVOLinkedList);   </span><br><span class="line">        <span class="keyword">return</span> resultVO;    &#125;    </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/add"</span>)    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResultVO <span class="title">add</span><span class="params">(@RequestParam(<span class="string">"name"</span>)</span>String name, @<span class="title">RequestParam</span><span class="params">(<span class="string">"age"</span>)</span>Integer age)</span>&#123;        </span><br><span class="line">        Customer customer = <span class="keyword">new</span> Customer();        </span><br><span class="line">        customer.setName(name);        </span><br><span class="line">        customer.setAge(age);        </span><br><span class="line">        customerService.add(customer);        </span><br><span class="line">        ResultVO resultVO = <span class="keyword">new</span> ResultVO();        </span><br><span class="line">        <span class="keyword">return</span> resultVO;    </span><br><span class="line">    &#125;    </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/search"</span>)    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResultVO <span class="title">searchByName</span><span class="params">(@RequestParam(<span class="string">"name"</span>)</span>String name)</span>&#123;        </span><br><span class="line">        Customer customer = customerService.searchByName(name);        </span><br><span class="line">        ResultVO resultVO = <span class="keyword">new</span> ResultVO(<span class="keyword">new</span> CustomerVO(customer));       </span><br><span class="line">        <span class="keyword">return</span> resultVO;    </span><br><span class="line">    &#125;    </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@PutMapping</span>(<span class="string">"/update"</span>)    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResultVO  <span class="title">updateById</span><span class="params">(@RequestParam(<span class="string">"id"</span>)</span>Long id,@<span class="title">RequestParam</span><span class="params">(<span class="string">"name"</span>)</span>String name,@<span class="title">RequestParam</span><span class="params">(<span class="string">"age"</span>)</span> Integer age)</span>&#123;        </span><br><span class="line">        Customer customer = <span class="keyword">new</span> Customer();        </span><br><span class="line">        customer.setId(id);        </span><br><span class="line">        customer.setAge(age);        </span><br><span class="line">        customer.setName(name);        </span><br><span class="line">        customerService.update(customer);        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResultVO();    &#125;    </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@DeleteMapping</span>(<span class="string">"/delete"</span>)    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResultVO <span class="title">deleteAll</span><span class="params">()</span></span>&#123;        </span><br><span class="line">        customerService.deleteAll();        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResultVO();    </span><br><span class="line">    &#125;    </span><br><span class="line">    </span><br><span class="line">    <span class="meta">@DeleteMapping</span>(value = <span class="string">"/delete"</span>,params = &#123;<span class="string">"id"</span>&#125;)    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResultVO <span class="title">deleteById</span><span class="params">(@RequestParam(value = <span class="string">"id"</span>,required = <span class="keyword">true</span>)</span>Integer id)</span>&#123;        </span><br><span class="line">        customerService.deleteById(id);        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ResultVO();    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Controller</code>完成简单的<code>CRUD</code>操作，都很简单，就不详细说明</p>
<blockquote>
<p>我们可以发现<code>deleteAll()</code>和<code>deleteById</code>都是匹配的<code>/customer/delete</code>这个<code>url</code></p>
<p>但是我们想根据不同的参数对象匹配不同的方法</p>
<p>我们只需要在<code>DeleteMapping</code>中设置<code>params ={&quot;&quot;}</code>即可，设定之后参数就是必须需要的。</p>
</blockquote>
<h4 id="运行结果">运行结果</h4>
<h5 id="GET-getall"><code>GET</code>  <code>/getall</code></h5>
<img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210608162522.png" style="zoom:80%;" />
<h5 id="POST-add"><code>POST</code> <code>/add</code></h5>
<img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210608162359.png" style="zoom:80%;" />
<h5 id="GET-search"><code>GET</code> <code>/search</code></h5>
<img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210608162448.png" style="zoom:80%;" />
<h5 id="PUT-update"><code>PUT</code> <code>/update</code></h5>
<img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210608162623.png" style="zoom:80%;" />
<img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210608162720.png" style="zoom:80%;" />
<h5 id="DELETE-delete"><code>DELETE</code> <code>/delete</code></h5>
<img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210608162905.png" style="zoom:80%;" />
<img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210608162930.png" style="zoom:80%;" />
<h5 id="DELETE-delete-id"><code>DELETE</code>  <code>/delete?id=</code></h5>
<img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210608162823.png" style="zoom:80%;" />
<img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210608162839.png" style="zoom:80%;" />
<h3 id="总结">总结</h3>
<p><code>mybatis</code>与<code>spring data jpa</code>相比，更加贴近原生<code>sql</code>,所以对于数据库的复杂操作更加方便，但是简单的<code>CRUD</code>就显得有点过于复杂。</p>
<p>所以我们接下来就要学习<code>mybatis</code>的增强<code>mybatis-plus</code>。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.caiwanghui.top/2021/06/15/SpringBoot%E6%95%B4%E5%90%88JPA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Wanghui Cai">
      <meta itemprop="description" content="一些零零散散的学习总结">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="菜鸡肥肥的私人博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/15/SpringBoot%E6%95%B4%E5%90%88JPA/" class="post-title-link" itemprop="url">SpringBoot整合JPA</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-06-14 22:12:16 / 修改时间：14:30:02" itemprop="dateCreated datePublished" datetime="2021-06-14T22:12:16Z">2021-06-14</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>10k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>9 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>Springboot 整合 JPA</h1>
<h3 id="简介">简介</h3>
<p><code>JPA</code>即<code>JAVA Persistance API</code> 是一种官方提出的<code>ORM</code>规范。</p>
<blockquote>
<p>什么是ORM？</p>
<p><code>ORM</code>即<code>Object-Relational Mapping</code>。他的作用是在关系型数据库和对象之间作一个映射，这样我们就不需要使用具体的<code>sql</code>语句 ，而是像平常一样操作对象即可。例如<code>Hibernate</code>就是很著名的<code>ORM</code>框架</p>
</blockquote>
<p><code>spring-data-jpa</code>便是<code>spring</code>基于<code>Hibernate</code>开发的一个<code>JPA</code>框架。极大的简化了<code>JPA</code>的写法，可以非常简单的实现<code>CRUD</code>和分页操作。</p>
<blockquote>
<p>复杂的sql操作也可以使用<code>@Query(&quot;SELECT * FROM TABLE WHERE user_name = :name&quot;)</code>，不过复杂的sql操作还是建议整合mybatis或者mybatis-plus。</p>
</blockquote>
<h3 id="使用示例">使用示例</h3>
<p><a href="https://github.com/bigmoom/springboot/tree/main/springboot%E6%95%B4%E5%90%88JPA" target="_blank" rel="noopener">程序源码</a></p>
<h4 id="建表">建表</h4>
<p>我们这里首先简单构建<code>customer</code>表，该表有<code>id</code>,<code>name</code>,<code>age</code>,<code>create_time</code>,<code>modify_time</code>属性，其中主键为<code>id</code>，递增。</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`customer`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`customer`</span>(</span><br><span class="line"><span class="string">`id`</span> <span class="built_in">BIGINT</span>(<span class="number">20</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">'id'</span>,</span><br><span class="line"><span class="string">`name`</span> <span class="built_in">VARCHAR</span>(<span class="number">64</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'姓名'</span>,</span><br><span class="line"><span class="string">`age`</span> <span class="built_in">SMALLINT</span>(<span class="number">3</span>)  <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">'年龄'</span> ,</span><br><span class="line"><span class="string">`create_time`</span> <span class="built_in">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">'创建时间'</span>,</span><br><span class="line"><span class="string">`modify_time`</span> <span class="built_in">TIMESTAMP</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">ON</span> <span class="keyword">UPDATE</span> <span class="keyword">CURRENT_TIMESTAMP</span> <span class="keyword">COMMENT</span> <span class="string">'更新时间'</span>,</span><br><span class="line">PRIMARY <span class="keyword">KEY</span>(<span class="string">`id`</span>)</span><br><span class="line">)<span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure>
<h4 id="pom-xml">pom.xml</h4>
<p>因为要连接数据库，并且使用<code>spring data jpa</code>，所以添加如下依赖</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 数据库连接 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--jpa--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="application-yml">application.yml</h4>
<p><code>Springboot</code>参数配置</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#端口设置</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8090</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#数据源设置</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="comment">#设置编码和时区</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/springboot?characterEncoding=utf-8&amp;serverTimezone=GMT%2B8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">1234</span></span><br><span class="line"></span><br><span class="line">   <span class="comment">#jpa设置</span></span><br><span class="line">  <span class="attr">jpa:</span></span><br><span class="line">    <span class="comment">#显示sql语句</span></span><br><span class="line">    <span class="attr">show-sql:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment">#format sql 语句</span></span><br><span class="line">    <span class="attr">hibernate:</span></span><br><span class="line">      <span class="attr">naming:</span></span><br><span class="line">        <span class="comment">#驼峰匹配</span></span><br><span class="line">        <span class="attr">physical-strategy:</span> <span class="string">org.springframework.boot.orm.jpa.hibernate.SpringPhysicalNamingStrategy</span></span><br><span class="line">        <span class="comment">#根据实体类自动更新表结构</span></span><br><span class="line">      <span class="attr">ddl-auto:</span> <span class="string">update</span></span><br></pre></td></tr></table></figure>
<p><code>Spring Data Jpa</code>默认使用驼峰命名法进行匹配</p>
<p>例如实体属性为<code>userName</code>，则匹配数据库表中<code>user_name</code>列</p>
<p>若不想使用驼峰匹配可以在属性上设置<code>@Column(name = &quot;user_name&quot;)</code>进行匹配。</p>
<blockquote>
<p><code>jpa.hibernate.ddl-auto</code>使用需要注意，该参数设置为每次启动<code>hibernate</code>自动根据实体类对表进行操作。</p>
<p><code>update</code>：这是最常使用的，用来在每次启动<code>hibernate</code> 根据实体类更新表结构。</p>
<p><code>create</code>：这就是最为要注意的，因为每次启动<code>hibernate</code>都会删除之前建的表，重新建表。</p>
<p><code>create-drop</code>：即加载<code>hibernate</code>时创建表，但是关闭之后表自动删除。</p>
</blockquote>
<h4 id="Entity">Entity</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table</span>(name=<span class="string">"customer"</span>)</span><br><span class="line"><span class="meta">@EntityListeners</span>(AuditingEntityListener<span class="class">.<span class="keyword">class</span>)</span></span><br><span class="line"><span class="class"><span class="title">public</span> <span class="title">class</span> <span class="title">Customer</span> </span>&#123;</span><br><span class="line"><span class="comment">//  主键</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line"><span class="comment">//  自增</span></span><br><span class="line"><span class="comment">//  自增策略由数据库控制</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span>(strategy = GenerationType.IDENTITY)</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"name"</span>)</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line"><span class="comment">//  自动修改创建更新时间</span></span><br><span class="line">    <span class="meta">@CreatedDate</span></span><br><span class="line">    <span class="keyword">private</span> Date createTime;</span><br><span class="line">    <span class="meta">@LastModifiedDate</span></span><br><span class="line">    <span class="keyword">private</span> Date modifiedTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实体类有五个属性<code>id</code>,<code>name</code>,<code>age</code>,<code>createTime</code>,<code>modifyTime</code>与表中<code>id</code>,<code>name</code>,<code>age</code>,<code>create_time</code>,<code>modify_time</code>一一对应。</p>
<p><code>@Id</code>标明这是主键</p>
<p><code>@GeneratedValue(strategy = GenerationType.IDENTITY)</code>标明主键是自增的,<code>strategy</code>为自增策略。</p>
<blockquote>
<p><code>strategy</code>有五种策略</p>
<p><code>TABLE</code>：spring-data-jpa 会自动建立一个<code>hibernate_sequence</code>表存放自增值</p>
<p><code>SEQUENCE</code>：根据数据库的序列生成主键（主要用于Oracle等不支持主键自增长的数据库）</p>
<p><code>IDENTITY</code>：使用数据库主键自增策略</p>
<p><code>AUTO</code>  程序自动选择一种策略</p>
</blockquote>
<p><code>@Column(name = &quot;user_name&quot;)</code>标明该属性对应表中的<code>user_name</code>列，可以不加，如果开启且满足驼峰匹配）。</p>
<p><code>@CreatedDate</code> 和<code>@LastModifiedDate</code>是<code>spring data jpa</code>提供的非常方便的自动修改数据库中表信息创建和修改时间。但是该实体类需要加上<code>@EntityListeners(AuditingEntityListener.class)</code>，且启动类需要加上<code>@EnableJpaAuditing</code>，以开启修改权限。</p>
<p><code>@Entity</code>标明这是一个实体类，只有添加了这个注释，<code>spring data jpa</code>才会去将它与数据库中的表进行映射。</p>
<p><code>@Table</code> 标明该实体类对应数据库中的表名称，与<code>@Entity</code>一样，也是可加可不加。</p>
<p><code>@Data</code>是插件<code>lombok</code>中的一个注释，他包含了常用的 <code>get(),set()</code>和无参全参构造器等等，帮我们省略了很多代码。</p>
<h4 id="数据库访问对象（DAO）">数据库访问对象（DAO）</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CustomerRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Customer</span>,<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">LinkedList&lt;Customer&gt; <span class="title">findByName</span><span class="params">(String name)</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以看到<code>spring data jpa</code>中建立数据库访问对象的方法是继承<code>JpaRepository&lt;,&gt;</code>，其中泛型括号中第一个参数为<strong>实体类</strong>，第二个对象为<strong>主键类型</strong>。</p>
<p>这相当于是建立了一个实体类仓库，仓库中对应这数据库中的该实体类映射的所有数据信息。</p>
<p>其实<code>spring data jpa</code>提供了不只这一种接口。</p>
<table>
<thead>
<tr>
<th style="text-align:center">接口</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center"><code>JpaRepository</code></td>
<td>是<code>PagingAndSortingRepository</code>的子接口，增加了一些功能，比如<code>findAll()</code></td>
</tr>
<tr>
<td style="text-align:center"><code>PagingAndSortingRepository</code></td>
<td>是<code>CrudRepository</code>的子接口，添加分页和排序的功能</td>
</tr>
<tr>
<td style="text-align:center"><code>CrudRepository</code></td>
<td>是<code>Repository</code>的子接口，提供<code>CRUD</code>的功能</td>
</tr>
<tr>
<td style="text-align:center"><code>Repository</code></td>
<td>最顶层的接口，是一個空的接口，目的是为了统一所有<code>Repository</code>的类型，且能让组件扫描的时候自动识别</td>
</tr>
</tbody>
</table>
<p>所以我们进行数据库简单操作的时候不需要自己编写具体代码，只需要继承相关接口，直接调用其中某些方法就行了。</p>
<blockquote>
<p>我们之所以不用写这些接口的实现类，是因为<code>Spring Data JPA</code> 最终将每个这样的<code>bean</code>最终映射到了一个统一的实现类<code>SimpleJpaRepository</code>的代理对象，而这个代理对象能支持所有每个自定义的<code>JpaRepository</code>接口定义的功能和<code>SimpleJpaRepository</code>类中定义的所有功能。</p>
</blockquote>
<h5 id="查询方法">查询方法</h5>
<p><code>spring data jpa</code>提供两种查询方法</p>
<ol>
<li>
<p>根据方法命名规范查询</p>
<p>例如<code>findByName(String name)</code>，<code>findAll()</code></p>
<table>
<thead>
<tr>
<th>关键字</th>
<th>方法命名</th>
<th>对应 sql 语句</th>
</tr>
</thead>
<tbody>
<tr>
<td>And</td>
<td>findByNameAndPwd</td>
<td>where name= ? and pwd =?</td>
</tr>
<tr>
<td>Or</td>
<td>findByNameOrSex</td>
<td>where name= ? or sex=?</td>
</tr>
<tr>
<td>Is,Equals</td>
<td>findById,findByIdEquals</td>
<td>where id= ?</td>
</tr>
<tr>
<td>Between</td>
<td>findByIdBetween</td>
<td>where id between ? and ?</td>
</tr>
<tr>
<td>LessThan</td>
<td>findByIdLessThan</td>
<td>where id &lt; ?</td>
</tr>
<tr>
<td>LessThanEquals</td>
<td>findByIdLessThanEquals</td>
<td>where id &lt;= ?</td>
</tr>
<tr>
<td>GreaterThan</td>
<td>findByIdGreaterThan</td>
<td>where id &gt; ?</td>
</tr>
<tr>
<td>GreaterThanEquals</td>
<td>findByIdGreaterThanEquals</td>
<td>where id &gt; = ?</td>
</tr>
<tr>
<td>After</td>
<td>findByIdAfter</td>
<td>where id &gt; ?</td>
</tr>
<tr>
<td>Before</td>
<td>findByIdBefore</td>
<td>where id &lt; ?</td>
</tr>
<tr>
<td>IsNull</td>
<td>findByNameIsNull</td>
<td>where name is null</td>
</tr>
<tr>
<td>isNotNull,NotNull</td>
<td>findByNameNotNull</td>
<td>where name is not null</td>
</tr>
<tr>
<td>Like</td>
<td>findByNameLike</td>
<td>where name like ?</td>
</tr>
<tr>
<td>NotLike</td>
<td>findByNameNotLike</td>
<td>where name not like ?</td>
</tr>
<tr>
<td>StartingWith</td>
<td>findByNameStartingWith</td>
<td>where name like ‘?%’</td>
</tr>
<tr>
<td>EndingWith</td>
<td>findByNameEndingWith</td>
<td>where name like ‘%?’</td>
</tr>
<tr>
<td>Containing</td>
<td>findByNameContaining</td>
<td>where name like ‘%?%’</td>
</tr>
<tr>
<td>OrderBy</td>
<td>findByIdOrderByXDesc</td>
<td>where id=? order by x desc</td>
</tr>
<tr>
<td>Not</td>
<td>findByNameNot</td>
<td>where name &lt;&gt; ?</td>
</tr>
<tr>
<td>In</td>
<td>findByIdIn(Collection&lt;?&gt; c)</td>
<td>where id in (?)</td>
</tr>
<tr>
<td>NotIn</td>
<td>findByIdNotIn(Collection&lt;?&gt; c)</td>
<td>where id not in (?)</td>
</tr>
<tr>
<td>True</td>
<td>findByAaaTue</td>
<td>where aaa = true</td>
</tr>
<tr>
<td>False</td>
<td>findByAaaFalse</td>
<td>where aaa = false</td>
</tr>
<tr>
<td>IgnoreCase</td>
<td>findByNameIgnoreCase</td>
<td>where UPPER(name)=UPPER(?)</td>
</tr>
</tbody>
</table>
</li>
<li>
<p>使用<code>@Query()</code>查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query</span>(value = <span class="string">"select * from customer c where c.name=?1"</span>)</span><br><span class="line"><span class="function">List&lt;Customer&gt; <span class="title">finByName</span><span class="params">(String name)</span></span></span><br></pre></td></tr></table></figure>
<p>个人觉得如果需要使用复杂<code>sql</code>语句，还是建议使用<code>mybatis/mybatis-plus</code>。</p>
</li>
</ol>
<h4 id="Service">Service</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CustomerService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Page&lt;Customer&gt; <span class="title">getAll</span><span class="params">(Integer pageNum, Integer pageSize)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Customer <span class="title">save</span><span class="params">(Customer customer)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LinkedList&lt;Customer&gt; <span class="title">searchByName</span><span class="params">(String name)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ServiceImpl">ServiceImpl</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerServiceImpl</span> <span class="keyword">implements</span> <span class="title">CustomerService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    注入数据仓库</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> CustomerRepository customerRepository;</span><br><span class="line">    </span><br><span class="line"><span class="comment">//    分页操作</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Page&lt;Customer&gt; <span class="title">getAll</span><span class="params">(Integer pageNum, Integer pageSize)</span> </span>&#123;</span><br><span class="line">        Pageable pageable = PageRequest.of(pageNum,pageSize);</span><br><span class="line">        Page&lt;Customer&gt; page = customerRepository.findAll(pageable);</span><br><span class="line">        <span class="keyword">return</span> page;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    对数据库修改之后的保存操作</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Customer <span class="title">save</span><span class="params">(Customer customer)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">return</span> customerRepository.save(customer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//    查询操作</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LinkedList&lt;Customer&gt; <span class="title">searchByName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> customerRepository.findByName(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>服务层是我们对功能逻辑实现的模块。</p>
<p>所以我们这边提供一些接口，以供控制层传入参数使用。</p>
<p>对于接口的实现类，我们首先注入我们自己定义的数据仓库，之后在具体方法内调用对数据仓库的具体操作。</p>
<p><code>demo</code>中定义了三个基本功能</p>
<h5 id="分页">分页</h5>
<p>由于我们的数据仓库继承了<code>PagingAndSortingRepository</code>接口，所以我们只需传入一个<code>Pageable</code>对象即可。</p>
<blockquote>
<p><code>pageable</code> 是 <code>spring data</code>里面的一个接口，可以通过<code>PageRequest.of(,)</code>传入<strong>页码</strong>，<strong>分页大小</strong>，<strong>排序方式</strong> 进行构建，也可以只传<strong>页码</strong>和<strong>分页大小</strong>，<strong>排序</strong>默认不排序。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">	<span class="comment">//PageRequest的构造方式	</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> PageRequest <span class="title">of</span><span class="params">(<span class="keyword">int</span> page, <span class="keyword">int</span> size)</span> </span>&#123;     </span><br><span class="line">    <span class="keyword">return</span> of(page, size, Sort.unsorted()); &#125; </span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> PageRequest <span class="title">of</span><span class="params">(<span class="keyword">int</span> page, <span class="keyword">int</span> size, Sort sort)</span> </span>&#123;     </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> PageRequest(page, size, sort); &#125;	</span><br><span class="line"><span class="comment">//继承了AbstractPageRequest	</span></span><br><span class="line"><span class="comment">//super(page,size)其实只是设定了page和size </span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="title">PageRequest</span><span class="params">(<span class="keyword">int</span> page, <span class="keyword">int</span> size, Sort sort)</span> </span>&#123;     </span><br><span class="line">    <span class="keyword">super</span>(page, size);     </span><br><span class="line">    Assert.notNull(sort, <span class="string">"Sort must not be null!"</span>);     </span><br><span class="line">    <span class="keyword">this</span>.sort = sort; &#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>所以我们这里首先传入<code>pageNum</code> <code>pageSize</code>构建一个<code>pageable</code>对象</p>
<p>然后调用数据仓库的<code>findAll(pageable)</code>方法，即可返回一个<code>page</code>对象</p>
<p><code>page</code>对象中包含了该页的所有数据以及一些相关信息，我们可以通过调用<code>page.getContent()</code>获取内容<code>List</code></p>
<h5 id="保存">保存</h5>
<p>我们所有的对数据库的增，改都需要调用数据仓库的<code>save()</code>方法</p>
<p><code>save()</code> 参数传入实体类对象，数据仓库实现对数据库中该实体类对应信息的修改操作</p>
<h5 id="查询">查询</h5>
<p>这里查询便是使用的上述查询的第一种方式 <strong>根据方法命名规范查询</strong></p>
<p><code>customerRepository.findByName(name)</code> 数据仓库识别方法名，即通过<code>Name</code>属性到数据库中进行查询。</p>
<blockquote>
<p>查询方法返回可以是一个实体类对象，也可以是一个实体类对象列表</p>
</blockquote>
<h4 id="VO">VO</h4>
<p>返回视图类主要包括信息码，返回信息，和具体数据。</p>
<p>我这里简单就只有一个<code>CustomerVO</code>，即实体类对象的一些信息。</p>
<h5 id="ResultVO">ResultVO</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@JsonInclude</span>(JsonInclude.Include.NON_NULL)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResultVO</span>&lt;<span class="title">T</span>&gt; </span>&#123;    </span><br><span class="line">    <span class="keyword">private</span> Integer code;    </span><br><span class="line">    <span class="keyword">private</span> String msg;    </span><br><span class="line">    <span class="keyword">private</span> T data;&#125;</span><br></pre></td></tr></table></figure>
<h5 id="CustomerVO">CustomerVO</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerVO</span> </span>&#123;    </span><br><span class="line">    <span class="meta">@JsonProperty</span>(value = <span class="string">"id"</span>)    </span><br><span class="line">    <span class="keyword">private</span> Integer id;    </span><br><span class="line">    <span class="meta">@JsonProperty</span>(value = <span class="string">"name"</span>)    </span><br><span class="line">    <span class="keyword">private</span> String name;    </span><br><span class="line">    <span class="meta">@JsonProperty</span>(value = <span class="string">"age"</span>)    </span><br><span class="line">    <span class="keyword">private</span> Integer age;    </span><br><span class="line">    <span class="meta">@JsonProperty</span>(value = <span class="string">"createTime"</span>)    </span><br><span class="line">    <span class="keyword">private</span> String createTime;    </span><br><span class="line">    <span class="meta">@JsonProperty</span>(value = <span class="string">"modifiedTime"</span>)    </span><br><span class="line">    <span class="keyword">private</span> String modifiedTime;    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> CustomerVO <span class="title">setByCustomer</span><span class="params">(Customer customer)</span></span>&#123;        </span><br><span class="line">        CustomerVO customerVO = <span class="keyword">new</span> CustomerVO();        </span><br><span class="line">        customerVO.setId(customer.getId());        </span><br><span class="line">        customerVO.setName(customer.getName());        </span><br><span class="line">        customerVO.setAge(customer.getAge());        </span><br><span class="line">        customerVO.setCreateTime(customer.getCreateTime().toString());        </span><br><span class="line">        customerVO.setModifiedTime(customer.getModifiedTime().toString());        </span><br><span class="line">        <span class="keyword">return</span> customerVO;    &#125;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Controller">Controller</h4>
<p>比较简单的<code>controller</code>，就不多赘述，相关信息见注释</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/customer"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomerController</span> </span>&#123;</span><br><span class="line">    <span class="comment">//  注入service接口    </span></span><br><span class="line">    <span class="meta">@Autowired</span>    </span><br><span class="line">    <span class="keyword">private</span> CustomerService customerService;    </span><br><span class="line">    <span class="comment">/**     </span></span><br><span class="line"><span class="comment">    * 分页展示     </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> pagenum 页码（第一页为0）     </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> pagesize 分页大小     </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span>     */</span>    </span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/getall"</span>)    </span><br><span class="line">    <span class="keyword">public</span> ResultVO&lt;LinkedList&lt;CustomerVO&gt;&gt; getAll(<span class="meta">@RequestParam</span>(<span class="string">"pagenum"</span>)Integer pagenum,<span class="meta">@RequestParam</span>(<span class="string">"pagesize"</span>)Integer pagesize) &#123;        </span><br><span class="line">        Page&lt;Customer&gt; page = customerService.getAll(pagenum,pagesize);</span><br><span class="line">        <span class="comment">//        获取页内数据内容        </span></span><br><span class="line">        List&lt;Customer&gt; customerList = page.getContent();</span><br><span class="line">        <span class="comment">//        设置VO        </span></span><br><span class="line">        ResultVO&lt;LinkedList&lt;CustomerVO&gt;&gt; resultVO = <span class="keyword">new</span> ResultVO();        </span><br><span class="line">        resultVO.setCode(<span class="number">1</span>);        </span><br><span class="line">        resultVO.setMsg(<span class="string">"succuss"</span>);        </span><br><span class="line">        LinkedList&lt;CustomerVO&gt; customerVOLinkedList = <span class="keyword">new</span> LinkedList&lt;CustomerVO&gt;();        </span><br><span class="line">        <span class="keyword">for</span>(Customer customer:customerList)&#123;            </span><br><span class="line">            CustomerVO customerVO = <span class="keyword">new</span> CustomerVO().setByCustomer(customer);        &#125;        resultVO.setData(customerVOLinkedList);        </span><br><span class="line">        <span class="keyword">return</span> resultVO;    &#125;    </span><br><span class="line">    <span class="comment">/**     </span></span><br><span class="line"><span class="comment">    * 添加用户     </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> name     </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> age     </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span>     */</span>    </span><br><span class="line">    <span class="meta">@PostMapping</span>(<span class="string">"/add"</span>)    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResultVO&lt;CustomerVO&gt; <span class="title">addCustomer</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">        @RequestParam(value=<span class="string">"name"</span>,required = <span class="keyword">true</span>)</span>String name,</span></span><br><span class="line"><span class="function">        @<span class="title">RequestParam</span><span class="params">(value=<span class="string">"age"</span>,required = <span class="keyword">true</span>)</span>Integer age)</span>&#123;        </span><br><span class="line">        Customer customer = <span class="keyword">new</span> Customer();        </span><br><span class="line">        customer.setAge(age);        </span><br><span class="line">        customer.setName(name);</span><br><span class="line">        <span class="comment">//        保存修改        </span></span><br><span class="line">        customerService.save(customer);</span><br><span class="line">        <span class="comment">//        设置VO        </span></span><br><span class="line">        ResultVO&lt;CustomerVO&gt; resultVO = <span class="keyword">new</span> ResultVO();       </span><br><span class="line">        resultVO.setCode(<span class="number">1</span>);        </span><br><span class="line">        resultVO.setMsg(<span class="string">"add success"</span>);        </span><br><span class="line">        CustomerVO customerVO = <span class="keyword">new</span> CustomerVO().setByCustomer(customer);        </span><br><span class="line">        resultVO.setData(customerVO);        </span><br><span class="line">        <span class="keyword">return</span> resultVO;    &#125;    </span><br><span class="line">    <span class="comment">/**    </span></span><br><span class="line"><span class="comment">    * 通过名字查询     </span></span><br><span class="line"><span class="comment">    * 可以有同名存在，所以返回List     </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> name     </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span>     */</span>    </span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/search"</span>)    </span><br><span class="line">    <span class="keyword">public</span> ResultVO&lt;LinkedList&lt;CustomerVO&gt;&gt; searchByName(<span class="meta">@RequestParam</span>(value=<span class="string">"name"</span>,required = <span class="keyword">true</span>)String name)&#123;        </span><br><span class="line">        ResultVO&lt;LinkedList&lt;CustomerVO&gt;&gt; resultVO = <span class="keyword">new</span> ResultVO();        </span><br><span class="line">        resultVO.setCode(<span class="number">1</span>);        </span><br><span class="line">        resultVO.setMsg(<span class="string">"search success"</span>);</span><br><span class="line">        <span class="comment">//        获取查询结果       </span></span><br><span class="line">        LinkedList&lt;Customer&gt; customerList = customerService.searchByName(name);</span><br><span class="line">        <span class="comment">//        设置VO        </span></span><br><span class="line">        LinkedList&lt;CustomerVO&gt; customerVOLinkedList = <span class="keyword">new</span> LinkedList();        </span><br><span class="line">        <span class="keyword">for</span>(Customer customer:customerList)&#123;            </span><br><span class="line">            CustomerVO customerVO = <span class="keyword">new</span> CustomerVO().setByCustomer(customer);            </span><br><span class="line">            customerVOLinkedList.add(customerVO);        &#125;        </span><br><span class="line">        resultVO.setData(customerVOLinkedList);        </span><br><span class="line">        <span class="keyword">return</span>  resultVO;    &#125;&#125;</span><br></pre></td></tr></table></figure>
<h4 id="运行结果">运行结果</h4>
<h5 id="GET-getAll"><code>GET</code> <code>/getAll</code></h5>
<img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210608101733.png" style="zoom:80%;" />
<h5 id="POST-add"><code>POST</code> <code>/add</code></h5>
<img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210608102406.png" style="zoom:80%;" />
<h5 id="GET-search"><code>GET</code> <code>/search</code></h5>
<img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210608102336.png" style="zoom:80%;" />
<h3 id="总结">总结</h3>
<p>怎么说呢，<code>Spring Data Jpa</code>给我们提供了非常简单的<code>CRUD</code>和<strong>分页排序</strong>操作，但是呢，对复杂的查询就没什么优势了。</p>
<p>所以个人建议，只有简单<code>CRUD</code>操作的可以用<code>Spring Data Jpa</code>，复杂的还是推荐<code>Mybatis/Mybatis-plus</code>。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.caiwanghui.top/2021/06/15/SpringBoot%E5%88%9D%E8%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Wanghui Cai">
      <meta itemprop="description" content="一些零零散散的学习总结">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="菜鸡肥肥的私人博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/06/15/SpringBoot%E5%88%9D%E8%AF%86/" class="post-title-link" itemprop="url">SpringBoot初识</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2021-06-14 22:11:54 / 修改时间：14:26:19" itemprop="dateCreated datePublished" datetime="2021-06-14T22:11:54Z">2021-06-14</time>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>9.5k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>9 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>SpringBoot 初识</h1>
<h3 id="IOC">IOC</h3>
<p>在我们接触Springboot之前，先了解一下一个概念 <code>IOC</code> 。</p>
<p><code>ioc</code> - <code>Inversion Of Control</code> 即 控制反转。这并不是某个语言专有的特性，而是一种编程思想。</p>
<p>我们之前编程的时候都是主动的去注入对象，即频繁的使用<code>new</code>去新建一个对象。这种编程方式看似没有什么大的问题，但是其实有很多可以改善的地方。</p>
<p>我们可以发现，当我们一个类特别复杂的时候，我们在代码中可能要<code>new</code> 数以百计甚至更多的对象，并且不主动使用垃圾回收机制进行清除，这种方式对于内存堆是非常不友好的，并且程序也非常繁冗，类与类之间耦合度极高，之后对代码的修改也非常困难。</p>
<p>所以呢，我们就引入了一个新的编程思想，就是<code>IOC</code>。<code>IOC</code>的核心思想便是使用容器去查找创建需要创建的对象。具体来说，就是我们只需要在代码中告诉容器，我整个过程需要会将使用到什么对象，那么之后容器便会在需要使用的时候自动去创建所需要的资源以供使用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name = <span class="string">"B"</span>;</span><br><span class="line">&#125;</span><br><span class="line">---------------------------------------------</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name=<span class="string">"A"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        B b= <span class="keyword">new</span>  B();</span><br><span class="line">        System.out.println(b.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们可以看到上面demo中有两个类，当A想使用B的时候，我是主动注入B，即<code>new</code>了一个B对象。这就是传统的创建对象的控制权在我们自己手中。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">B</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name = <span class="string">"B"</span>;</span><br><span class="line">&#125;</span><br><span class="line">--------------------------------------------</span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name = <span class="string">"A"</span>;</span><br><span class="line">    <span class="comment">//自动注入</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> B b;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(b.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>可以看到这次demo中我并没有使用<code>new</code>去新建对象，而是使用<code>@Autowired</code>将B组件注入到A中，即当A发现我需要使用B的时候，容器便会自动创建对象B以供使用。此时B需要加上<code>@Component</code>注解标明这是一个组件，然后将它放入容器中，这样容器之后才会在组件列表中找到并创建它。</p>
<blockquote>
<p>这里说下<code>@Component</code>和 <code>@Bean</code>的区别。</p>
<p>在Springboot中，<code>@Component</code>用于注解一个类，告诉Sprongboot，在程序启动之前需要将整个类作为<code>Bean</code>对象放入<code>IOC</code>容器中。</p>
<p>而<code>@Bean</code>则是用于注解一个方法，该方法为创建一个实例对象的具体逻辑。注解在方法上便是告诉程序启动之前将该方法的返回实例注入到<code>IOC</code>容器中。</p>
</blockquote>
<h3 id="DI">DI</h3>
<p>当我们说到<code>IOC</code>的时候，往往会提及一个概念<code>DI</code>，<code>Dependency Injection</code>即依赖注入。</p>
<p>其实上面我们介绍<code>IOC</code>的时候就已经介绍完了<code>DI</code>，因为<code>DI</code>就是我们实现<code>IOC</code>思想的一个具体方法。即在<code>IOC</code>容器运行过程中，当前实体被动地被<code>IOC</code>容器注入其依赖的组件。</p>
<h3 id="Springboot结构概览">Springboot结构概览</h3>
<p>了解完<code>IOC</code>之后，我们其实也就了解了<code>Springboot</code>框架的一个整体思想。就是构建不同的组件，自动装配这些组件然后运行以完成我们的具体需求。</p>
<blockquote>
<p>本人所有java代码都是使用idea进行编写，所以直接使用idea创建Springboot initializr创建Springboot工程文件。</p>
</blockquote>
<p>我们先来看一下Springboot的一个大概的文件结构</p>
<img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210607103454.png" style="zoom:80%;" />
<h4 id="配置文件">配置文件</h4>
<p>我们先看一下<code>application.yml</code>的一个<code>demo</code></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://localhost:3306/testdatabase?useUnicode=true&amp;characterEncoding=utf-8&amp;allowMultiQueries=true&amp;serverTimezone=GMT%2B8</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">1234</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line">  <span class="attr">servlet:</span></span><br><span class="line">    <span class="attr">context-path:</span> <span class="string">/mybatis</span></span><br><span class="line"></span><br><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.springstudy.mybatistest.entity</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:com.springstudy.mybatis.DAO/*Mapper.xml</span></span><br></pre></td></tr></table></figure>
<p>这里是Springboot的一些设定，例如服务器端口<code>server.port</code>，数据源<code>spring.datasource</code>，<code>Mybatis</code>的<code>mapper</code>文件位置等等。具体设定看使用需求。</p>
<blockquote>
<p>springboot 默认配置文件原来是application.properties，这里改为yml只是为了格式易读，规范。</p>
</blockquote>
<h4 id="Controller">Controller</h4>
<blockquote>
<p>现在的项目都是前后端分离开发的，常见的项目框架便是<code>Vue+Springboot</code>去构建。整体思路便是前端发送请求给后端，后端根据不同请求以及请求中携带的参数进行一些处理，然后将处理结果以及其他一些数据传给前端。这样前后端便可以分离开来，大大减轻了开发难度。后端人员专注于后端，前端人员专注于前端。</p>
</blockquote>
<p>那么<code>Controller</code>便作为<code>Springboot</code>中接受请求的一层。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/getmessage"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMessage</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"getMessage success"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这便是一个十分简单的<code>controller</code>，该<code>controller</code>捕获前端在URL为<code>/getmessage</code>的<code>GET</code>请求，然后将<code>String</code>对象返回给前端。</p>
<blockquote>
<p>这里@RestController告诉IOC容器这是一个Controller组件，并且返回实体内容，等于@Controller+@RequestBody，如果没有@RequestBody，则返回String对象时会自动进行重定向识别。</p>
<p>@GetMapping(&quot;/getmessage&quot;)表明该方法匹配Get请求，对应Url为括号里的参数.</p>
</blockquote>
<p>我们使用<code>Postman</code>看一下返回结果（<code>Postman</code>用于测试各种请求非常方便，具体使用可以自行查询。）</p>
<img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210607105934.png" style="zoom: 80%;" />
<p>可以看到<code>String</code>对象返回成功。</p>
<p>上面的<code>Controller</code>只是一个非常简单的<code>demo</code>，让我们来看下具体项目中的一个<code>Controller</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping</span>(<span class="string">"/API/user"</span>)</span><br><span class="line"><span class="meta">@Auth</span>(id = <span class="number">1000</span>, name = <span class="string">"用户管理"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> ResourceService resourceService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping</span></span><br><span class="line">    <span class="meta">@Auth</span>(id = <span class="number">1</span>, name = <span class="string">"新增用户"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">createUser</span><span class="params">(@RequestBody @Validated(UserParam.CreateUser.class)</span> UserParam param) </span>&#123;</span><br><span class="line">        userService.createUser(param);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"操作成功"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping</span></span><br><span class="line">    <span class="meta">@Auth</span>(id = <span class="number">2</span>, name = <span class="string">"删除用户"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">deleteUser</span><span class="params">(Long[] ids)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (ArrayUtils.isEmpty(ids)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ApiException(ResultCode.VALIDATE_FAILED);</span><br><span class="line">        &#125;</span><br><span class="line">        userService.removeByIds(Arrays.asList(ids));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"操作成功"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping</span></span><br><span class="line">    <span class="meta">@Auth</span>(id = <span class="number">3</span>, name = <span class="string">"编辑用户"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">updateRoles</span><span class="params">(@RequestBody @Validated(UserParam.Update.class)</span> UserParam param) </span>&#123;</span><br><span class="line">        userService.update(param);</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"操作成功"</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>这是一个简单的实现<code>CRUD（增删改查）</code>的用户管理<code>controller</code>。</p>
<p>该<code>Controller</code>匹配<code>/API/user</code>的各种请求。对于不同请求匹配不同的方法，返回不同的结果给前端。</p>
<blockquote>
<p>@Slf4j 该注释标明使用日志模块log4j，这个后续会具体说明。</p>
<p>@Auth 是自己定义的注解，用于权限设定，后面也会具体讲到如何自定义注解。</p>
</blockquote>
<blockquote>
<p>这里相同的url根据不同的请求方式调用不同方法便是RESTful 的编程风格</p>
<p>Get 用于获取数据。</p>
<p>Put 用于发送数据，常用于更新修改操作。</p>
<p>Post 用于创建新内容。</p>
<p>Delete 就是用于删除内容。</p>
</blockquote>
<blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> ResourceService resourceService;</span><br></pre></td></tr></table></figure>
<p>这里使用@Autowired 注解注入resourceService，告诉IOC容器该controller需要使用resouceService组件，并在之后使用过程自动注入。</p>
</blockquote>
<p>上面代码中使用<code>@RequestBody</code>标明参数是以json形式整体发送过来。</p>
<p>当然我们也可以发送单独的参数，即使用<code>@RequestParam,@PathVariable</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/addmessage"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">addmessage</span><span class="params">(@RequestParam(value=<span class="string">"name"</span>,required = <span class="keyword">true</span>)</span>String name,@<span class="title">RequestParam</span><span class="params">(<span class="string">"age"</span>)</span> Integer age) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"name:"</span> + name + <span class="string">" age:"</span> + age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>返回结果：</p>
<img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210607112431.png" style="zoom:67%;" />
<p><code>@RequestParam</code>匹配<code>url</code>中传入的参数，上面<code>addmessage()</code>具体匹配<code>url:/addmessage?name=cwh&amp;age=23</code></p>
<p>我们再来看看<code>@PathVariable</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping</span>(<span class="string">"/addmessage/&#123;name&#125;"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">addmessage</span><span class="params">(@PathVariable(<span class="string">"name"</span>)</span>String name) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"name:"</span> + name;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>返回结果:</p>
<img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210607113023.png" style="zoom:67%;" />
<p><code>@PathVariable</code>标明该请求参数以<code>url:/addmessage/cwh</code>的形式传入。</p>
<p>所以这两个注解作用没什么区别，只是对于不同参数传递方式使用不同方式获取参数。</p>
<h4 id="DAO">DAO</h4>
<p><code>DAO</code>全称<code>Data Access Object</code>，即数据连接层。简单来说，就是实现数据库表中数据与实体类一一对应的功能层。例如我们使用<code>springboot-data-jpa</code>或者<code>mybatis/mybatis-plus</code>连接数据库，完成数据库数据与实体类映射的<code>repository</code>和<code>mapper</code>。<code>jpa</code>和<code>mybatis</code>的具体使用后续会详细介绍。</p>
<p>我个人倾向于把<code>entity</code>实体类也放在<code>dao</code>下，有利于逻辑理解。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Mapper</span></span><br><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentMapper</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**     </span></span><br><span class="line"><span class="comment">    * 通过id查询学生     </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@param</span> id     </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span>     */</span>    </span><br><span class="line">    <span class="function">Student <span class="title">queryById</span><span class="params">(@Param(<span class="string">"id"</span>)</span>Integer id)</span>;    </span><br><span class="line">    <span class="comment">/**     </span></span><br><span class="line"><span class="comment">    * 返回学生列表     </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span>     */</span>    </span><br><span class="line">    <span class="function">List&lt;Student&gt; <span class="title">queryAll</span><span class="params">()</span></span>;    </span><br><span class="line">    <span class="comment">/**     </span></span><br><span class="line"><span class="comment">    * 返回列表数量     </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span>     */</span>    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">getNum</span><span class="params">()</span></span>;    </span><br><span class="line">    <span class="comment">/**     </span></span><br><span class="line"><span class="comment">    * 插入学生信息     </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span>     */</span>/    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(@Param(<span class="string">"id"</span>)</span>Integer id,@<span class="title">Param</span><span class="params">(<span class="string">"name"</span>)</span>String name,@<span class="title">Param</span><span class="params">(<span class="string">"sex"</span>)</span>String sex)</span>;    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(@Param(<span class="string">"student"</span>)</span>Student student)</span>;    </span><br><span class="line">    <span class="comment">/**     </span></span><br><span class="line"><span class="comment">    * 更新学生信息     </span></span><br><span class="line"><span class="comment">    * <span class="doctag">@return</span>     */</span>    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateById</span><span class="params">(@Param(<span class="string">"id"</span>)</span>Integer id,@<span class="title">Param</span><span class="params">(<span class="string">"name"</span>)</span>String name,@<span class="title">Param</span><span class="params">(<span class="string">"sex"</span>)</span>String sex)</span>;    </span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteById</span><span class="params">(@Param(<span class="string">"id"</span>)</span>Integer id)</span>;&#125;</span><br></pre></td></tr></table></figure>
<p>这是<code>mybatis</code>的<code>mapper</code>接口,接口对应相应的<code>mapper.xml</code>文件，<code>mapper.xml</code>中实现实体类与表中数据的映射以及接口方法的各种数据库实现。</p>
<h4 id="Service">Service</h4>
<p><code>Service</code>层是<code>Springboot</code>主要的逻辑处理层。</p>
<p>我们一般是在<code>service</code>中注入<code>Dao</code>层中与数据库连接的接口，即可以理解为获取数据库信息，以形参实现该服务接口所需要的逻辑过程。最后<code>controller</code>层注入<code>service</code>，以请求中的参数完成最终的功能。</p>
<p>但是我们对于·层一般都是定义一堆接口，然后分别创建接口的实现，毕竟这样以后可以一个接口有多个实现，虽然我更倾向于一个<code>service</code>接口实现一个具体功能。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">StudentService.java</span><br><span class="line">=============================================    </span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">StudentService</span> </span>&#123;    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Student <span class="title">getStudentById</span><span class="params">(Integer id)</span></span>;    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Student&gt; <span class="title">getAll</span><span class="params">()</span></span>;    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNum</span><span class="params">()</span></span>;    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> ResultVO <span class="title">insert</span><span class="params">(Student student)</span></span>;&#125;</span><br><span class="line">----------------------------------------------</span><br><span class="line">StudentServiceImpl.java</span><br><span class="line">==============================================</span><br><span class="line">    <span class="meta">@Service</span></span><br><span class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentServiceImpl</span> <span class="keyword">implements</span> <span class="title">StudentService</span> </span>&#123;    </span><br><span class="line">        <span class="meta">@Autowired</span>    </span><br><span class="line">        <span class="keyword">private</span> StudentDao studentDao;    </span><br><span class="line">        <span class="meta">@Override</span>    </span><br><span class="line">        <span class="function"><span class="keyword">public</span> Student <span class="title">getStudentById</span><span class="params">(Integer id)</span> </span>&#123;        </span><br><span class="line">            <span class="keyword">return</span> studentDao.queryById(id);    &#125;    </span><br><span class="line">        <span class="meta">@Override</span>    </span><br><span class="line">        <span class="function"><span class="keyword">public</span> List&lt;Student&gt; <span class="title">getAll</span><span class="params">()</span></span>&#123;        </span><br><span class="line">            <span class="keyword">return</span> studentDao.queryAll();    &#125;    </span><br><span class="line">        <span class="meta">@Override</span>    </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getNum</span><span class="params">()</span> </span>&#123;        </span><br><span class="line">            <span class="keyword">return</span> studentDao.getNum();    &#125;     </span><br><span class="line">        </span><br><span class="line">        <span class="meta">@Override</span>    </span><br><span class="line">        <span class="function"><span class="keyword">public</span> ResultVO <span class="title">insert</span><span class="params">(Student student)</span> </span>&#123;</span><br><span class="line">            studentDao.insert(student);        </span><br><span class="line">            ResultVO resultVO = <span class="keyword">new</span> ResultVO();        </span><br><span class="line">            resultVO.setCode(<span class="number">1</span>);        </span><br><span class="line">            resultVO.setMsg(<span class="string">"insert success"</span>);        </span><br><span class="line">            <span class="keyword">return</span> resultVO;    &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Slf</span>4j</span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">StudentController</span> </span>&#123;    </span><br><span class="line">    <span class="meta">@Autowired</span>    </span><br><span class="line">    <span class="keyword">private</span> StudentServiceImpl studentService;    </span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/query"</span>)    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Student <span class="title">getStudentById</span><span class="params">(@RequestParam(<span class="string">"id"</span>)</span>Integer id)</span>&#123;        </span><br><span class="line">        Student student = studentService.getStudentById(id);    </span><br><span class="line">        log.info(student.getStuName());        </span><br><span class="line">        <span class="keyword">return</span> student;    &#125;	</span><br><span class="line">    .......    .......    </span><br><span class="line">        </span><br><span class="line">    <span class="meta">@GetMapping</span>(<span class="string">"/queryall"</span>)  </span><br><span class="line">	<span class="function"><span class="keyword">public</span> List&lt;Student&gt; <span class="title">getAll</span><span class="params">()</span></span>&#123;        </span><br><span class="line">        <span class="keyword">return</span> studentService.getAll();    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面<code>demo</code>是一个对<code>student</code>表的简单<code>CRUD</code>功能的逻辑实现。</p>
<blockquote>
<ol>
<li>我们定义逻辑接口StudentService</li>
<li>定义StudentServiceImpl实现上述接口（使用@Service告诉Springboot这是一个service组件）</li>
<li>注入StudentDao，提供数据库相关功能</li>
<li>Controller中注入StudentService(注入接口即可，Springboot会自动注入其实现类，但是一个接口多个实现类的时候需要标明设定的实现类ID)</li>
</ol>
</blockquote>
<h4 id="VO">VO</h4>
<p><code>vo</code>主要是返回视图层，即返回给前端的数据的具体格式。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@JsonInclude</span>(JsonInclude.Include.NON_NULL)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ResultVO</span>&lt;<span class="title">T</span>&gt; </span>&#123;    </span><br><span class="line">    <span class="comment">//返回代码    </span></span><br><span class="line">    <span class="keyword">private</span> Integer code;    </span><br><span class="line">    <span class="comment">//返回提示信息    </span></span><br><span class="line">    <span class="keyword">private</span> String msg;    </span><br><span class="line">    <span class="comment">//返回具体内容    </span></span><br><span class="line">    <span class="keyword">private</span> T data;    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ResultVO</span><span class="params">()</span></span>&#123;    &#125;    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ResultVO</span><span class="params">(Integer code, String msg)</span></span>&#123;        </span><br><span class="line">        <span class="keyword">this</span>.code = code;        </span><br><span class="line">        <span class="keyword">this</span>.msg = msg;    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这就是一个简单的返回视图类。</p>
<p>返回一个信息码，一个提示信息还有一个泛型T的data数据。</p>
<blockquote>
<p>这里@JsonInclude(JsonInclude.Include.NON_NULL) 是标明null不参与序列化，即如果结果中有null，该属性不显示。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@GetMapping</span>(<span class="string">"/addmessage"</span>)    </span><br><span class="line"><span class="function"><span class="keyword">public</span> ResultVO&lt;String&gt; <span class="title">getmessage</span><span class="params">(@RequestParam(value=<span class="string">"name"</span>,required = <span class="keyword">true</span>)</span>String name )</span>&#123;        </span><br><span class="line">    ResultVO resultVO = <span class="keyword">new</span> ResultVO();        </span><br><span class="line">    resultVO.setCode(<span class="number">1</span>);        </span><br><span class="line">    resultVO.setMsg(<span class="string">"success"</span>);        </span><br><span class="line">    resultVO.setData(<span class="string">"name:"</span>+name);        </span><br><span class="line">    <span class="keyword">return</span> resultVO;    &#125;</span><br></pre></td></tr></table></figure>
<img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/20210607141148.png" style="zoom:80%;" />
<p>我们可以看到<code>VO</code>层主要是规范化返回信息，便于前端处理收到的信息。</p>
<p>例如前端和后端设计一个功能，后端只需要返回通用的<code>ResultVO</code>，这样前端只需要获取<code>data.code或者data.data</code>而不用频繁定义对象去接受不同的结果。这样也便于前后端分离开发。</p>
<h4 id="config-annotation-exception…">config,annotation,exception…</h4>
<p>其余的层数都是不必须的，当需要的时候进行适当编写即可。</p>
<p><code>config</code>层主要是包括了一些配置函数。</p>
<p>例如之后要使用的<code>spring security</code>，我们便要定义自己的<code>SecurityConfg</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span>    </span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">configure</span><span class="params">(HttpSecurity http)</span> <span class="keyword">throws</span> Exception </span>&#123;        </span><br><span class="line">    <span class="comment">// 关闭csrf和frameOptions，如果不关闭会影响前端请求接口（这里不展开细讲了，感兴趣的自行搜索，不难）        </span></span><br><span class="line">    http.csrf().disable();        </span><br><span class="line">    http.headers().frameOptions().disable();        </span><br><span class="line">    <span class="comment">// 开启跨域以便前端调用接口        </span></span><br><span class="line">    http.cors();        </span><br><span class="line">    <span class="comment">// 这是配置的关键，决定哪些接口开启防护，哪些接口绕过防护        </span></span><br><span class="line">    http.authorizeRequests()                </span><br><span class="line">        <span class="comment">// 注意这里，是允许前端跨域联调的一个必要配置                </span></span><br><span class="line">        .requestMatchers(CorsUtils::isPreFlightRequest).permitAll()              </span><br><span class="line">        <span class="comment">// 指定某些接口不需要通过验证即可访问。像登陆、注册接口肯定是不需要认证的               </span></span><br><span class="line">        .antMatchers(<span class="string">"/API/login"</span>, <span class="string">"/API/register"</span>).permitAll()                </span><br><span class="line">    	<span class="comment">// 这里意思是其它所有接口需要认证才能访问                </span></span><br><span class="line">        .antMatchers(<span class="string">"/API/**"</span>).authenticated()                </span><br><span class="line">        <span class="comment">// 指定认证错误处理器                </span></span><br><span class="line">        .and().exceptionHandling().authenticationEntryPoint(<span class="keyword">new</span>                                                           MyEntryPoint()).accessDeniedHandler(<span class="keyword">new</span> MyDeniedHandler());        </span><br><span class="line">    <span class="comment">// 禁用session              </span></span><br><span class="line">    http.sessionManagement().sessionCreationPolicy(SessionCreationPolicy.STATELESS);        </span><br><span class="line">    <span class="comment">// 将我们自定义的认证过滤器替换掉默认的认证过滤器        </span></span><br><span class="line">    http.addFilterBefore(loginFilter, UsernamePasswordAuthenticationFilter<span class="class">.<span class="keyword">class</span>)</span>;        </span><br><span class="line">    http.addFilterBefore(authFilter, FilterSecurityInterceptor<span class="class">.<span class="keyword">class</span>)</span>;    &#125;</span><br></pre></td></tr></table></figure>
<p>关于<code>spring security</code>相关配置我们后续再具体介绍，这里只需看看即可。</p>
<p><code>annotation</code> 层主要包含了一些我们自己定义的注解。</p>
<p>例如我们之后要学习的<code>AOP</code>的知识，其中一种方式就是通过注解实现AOP，实现例如日志记录，权限校验等功能。</p>
<p><code>Exception</code>层主要包含了我们自定义的一些异常。</p>
<p>在Springboot中我们可以通过<code>@ControllerAdvice+@ExceptionHandler</code>进行统一异常管理</p>
<p>统一异常管理不仅仅是简化代码其实也是为了规范返回数据格式。</p>
<blockquote>
<p>还有很多层，例如<code>Aspect</code>定义我们AOP的切面逻辑，<code>utils</code>工具层等等。</p>
<p>这些都不是定死的，你也可以都写在一个包里面，我们这么做只是为了逻辑更加鲜明，便于工程管理。</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.caiwanghui.top/2020/03/12/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Wanghui Cai">
      <meta itemprop="description" content="一些零零散散的学习总结">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="菜鸡肥肥的私人博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/12/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/" class="post-title-link" itemprop="url">线性代数相关知识</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-11 20:09:32" itemprop="dateCreated datePublished" datetime="2020-03-11T20:09:32Z">2020-03-11</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-03-24 06:10:28" itemprop="dateModified" datetime="2020-03-24T06:10:28Z">2020-03-24</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" itemprop="url" rel="index"><span itemprop="name">基础知识</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>47k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>42 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>因为准备忙毕设的事情，就开始学习推荐系统的相关知识，但是一开始就看到<code>item-based CF</code>和<code>SVD</code>的时候，发现很多线性代数的知识都忘了，就准备开这篇来重新学习一下 <strong>线性代数</strong></p>
</blockquote>
<blockquote>
<p>我主要以<code>YouTube</code>上 <a href="https://www.youtube.com/playlist?list=PL0Kneloi6O0zyVKekh4faY6vun_jkDVko" target="_blank" rel="noopener">为程序员设计的线性代数课程</a> 为资源展开学习（这个貌似是慕课网的资源）</p>
<p>后来发现B站也有。<a href="https://www.bilibili.com/video/av94991431" target="_blank" rel="noopener">B站链接</a>（好像没了）</p>
</blockquote>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/03/12/%E7%BA%BF%E6%80%A7%E4%BB%A3%E6%95%B0%E7%9B%B8%E5%85%B3%E7%9F%A5%E8%AF%86/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.caiwanghui.top/2020/03/09/Markdown-%E7%9B%B8%E5%85%B3%E8%AF%AD%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Wanghui Cai">
      <meta itemprop="description" content="一些零零散散的学习总结">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="菜鸡肥肥的私人博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/09/Markdown-%E7%9B%B8%E5%85%B3%E8%AF%AD%E6%B3%95/" class="post-title-link" itemprop="url">Markdown常用操作</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-08 22:45:57" itemprop="dateCreated datePublished" datetime="2020-03-08T22:45:57Z">2020-03-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-03-11 11:44:53" itemprop="dateModified" datetime="2020-03-11T11:44:53Z">2020-03-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Markdown/" itemprop="url" rel="index"><span itemprop="name">Markdown</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="标题">标题</h2>
<p>Markdown <strong>支持两种形式</strong></p>
<ol>
<li>
<p><strong>用<code>#</code>作为标记符</strong> （<strong>Typora</strong>中快捷键为<code>ctrl+对应数字</code>）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 一级标题</span><br><span class="line">## 二级</span><br><span class="line">### 三级</span><br><span class="line">...</span><br><span class="line">###### 六级标题</span><br></pre></td></tr></table></figure>
<p>显示结果如下：（<code>typora</code>貌似不支持<strong>跨级标签</strong>，还有<code>#</code>之后要有一个<strong>空格</strong>）</p>
<p><img src="https://typora-cwh.oss-cn-hangzhou.aliyuncs.com/typora/20200309145634.png" alt=""></p>
</li>
<li>
<p><strong>用<code>=</code>和<code>-</code>标记</strong></p>
<p>即在 <strong>标题下面</strong> 加上任意个<code>=</code>表 <strong>一级标题</strong>，<code>-</code>表 <strong>二级标题</strong>（个人不喜欢​ 😉）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">一级标题</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;</span><br><span class="line"></span><br><span class="line">二级标题</span><br><span class="line">--------</span><br></pre></td></tr></table></figure>
<p>效果如上</p>
</li>
</ol>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/03/09/Markdown-%E7%9B%B8%E5%85%B3%E8%AF%AD%E6%B3%95/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

        
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block home" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://www.caiwanghui.top/2020/03/09/First-Blog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Wanghui Cai">
      <meta itemprop="description" content="一些零零散散的学习总结">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="菜鸡肥肥的私人博客">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/03/09/First-Blog/" class="post-title-link" itemprop="url">First Blog</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-03-08 19:21:07" itemprop="dateCreated datePublished" datetime="2020-03-08T19:21:07Z">2020-03-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-03-11 08:42:38" itemprop="dateModified" datetime="2020-03-11T08:42:38Z">2020-03-11</time>
              </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="fa fa-file-word-o"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>146</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="fa fa-clock-o"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1>写于正式博客之前</h1>
<ol>
<li>创建自己私人博客的初心主要还是为了总结自己学的东西，不想再在<code>Google</code>里边那个<code>keep</code>一个一个找，实在是太麻烦了。</li>
<li>其次，就是感觉这样很吊，就当为了以后的社招提前做准备，毕竟私人博客写的好的话也是能加不少分的。</li>
<li>先写这么多，主要也是测试一下<code>hexo</code>的样式感觉一下😄</li>
</ol>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/03/09/First-Blog/#more" rel="contents">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

  </div>

  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Wanghui Cai"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Wanghui Cai</p>
  <div class="site-description" itemprop="description">一些零零散散的学习总结</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">9</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/bigmoom" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;bigmoom" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:15850180970@163.com" title="E-Mail → mailto:15850180970@163.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        
  <div class="beian"><a href="https://beian.miit.gov.cn/#/Integrated/index" rel="noopener" target="_blank">苏ICP备20010524 </a>
  </div>

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Wanghui Cai</span>
</div>




        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  
  <script>
    (function(){
      var bp = document.createElement('script');
      var curProtocol = window.location.protocol.split(':')[0];
      bp.src = (curProtocol === 'https') ? 'https://zz.bdstatic.com/linksubmit/push.js' : 'http://push.zhanzhang.baidu.com/push.js';
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(bp, s);
    })();
  </script>















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script><!-- hexo-inject:begin --><!-- hexo-inject:end -->

    

  

</body>
</html>
